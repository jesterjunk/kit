function F(e,n){let t=e,r=0;for(;r<n.length&&t!==void 0;)t=t?.[n[r]],r++;return t}function R(e,n,t){let r=e;const i=n.length-1;let o=0;for(;o<i;){const u=n[o];r[u]===void 0&&(typeof n[o+1]=="number"?r[u]=[]:r[u]={}),r=r[u],o++}return r[n[i]]=t,e}function g(e){return typeof e=="object"&&e!==null&&e.constructor===Object}function M(e){return g(e)||Array.isArray(e)}function $(e){return e.map((n,t)=>typeof n=="number"?"["+n+"]":/[.\[\]]/.test(n)||n===""?'["'+j(n)+'"]':(t>0?".":"")+n).join("")}function j(e){return e.replace(/"/g,'\\"')}function q(e){const n=[];let t=0;for(;t<e.length;)if(e[t]==="."&&t++,e[t]==="["){if(t++,e[t]==='"')t++,n.push(r(o=>o==='"',!0)),i('"');else{const o=r(u=>u==="]");n.push(o)}i("]")}else n.push(r(o=>o==="."||o==="["));function r(o){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f="";for(;t<e.length&&!o(e[t]);)u&&e[t]==="\\"&&e[t+1]==='"'?(f+='"',t+=2):(f+=e[t],t++);return!u&&/^ *\d+ *$/.test(f)?parseInt(f):f}function i(o){if(e[t]!==o)throw new SyntaxError(`Invalid JSON path: ${o} expected at position ${t}`);t++}return n}function I(e,n){return T(e,n).map(t=>({name:$(t),getValue:J(t)}))}function L(e,n){return _(e).map(t=>{const r=q(t),i=r[0];return{name:t,setValue:r.length===0||!n?(o,u)=>o[t]=u:r.length===1?(o,u)=>o[i]=u:(o,u)=>R(o,r,u)}})}function _(e){const n=new Set;return e.map(t=>{let r=t,i=0;for(;n.has(r);)i++,r=t+"_"+i;return n.add(r),r})}function k(e,n){const t=[];for(let r of n){const i=r.index!==void 0?r.index:e.indexOf(r.name);if(i===-1)throw new Error(`Field "${r.name}" not found in the csv data`);if(t[i])throw new Error(`Duplicate field for index ${i}`);t[i]=r}return t}const h=Symbol();function T(e,n){const t={};e.forEach(i=>{n(i)||g(i)?C(i,t,n):E(i,t)});const r=[];return A(t,[],r),r}function C(e,n,t){for(const r in e){const i=e[r],o=n[r]||(n[r]=Array.isArray(i)?[]:{});t(i)?C(i,o,t):E(i,o)}}function E(e,n){n[h]===void 0&&(n[h]=e==null?null:!0)}function A(e,n,t){if(e[h]===!0||e[h]===null&&P(e))t.push(n);else if(Array.isArray(e))e.forEach((r,i)=>A(r,n.concat(i),t));else if(g(e))for(const r in e)A(e[r],n.concat(r),t)}function J(e){if(e.length===1){const n=e[0];return t=>t[n]}return n=>F(n,e)}function P(e){return Object.keys(e).length===0}function D(e){const n=new RegExp("["+e+`"\r
]`),t=/"/g;function r(i){return n.test(i)||i.length===0?`"${i.replaceAll(t,'""')}"`:i}return function i(o){return typeof o=="string"?r(o):typeof o=="number"||typeof o=="boolean"?o+"":o==null?"":i(JSON.stringify(o))}}function H(e,n){if(e[0]>="-"&&e[0]<="9"){const t=Number(e);return isNaN(t)?e:t}if(e==="true")return!0;if(e==="false")return!1;if(e==="null"||e.length===0&&!n)return null;if(e[0]==="{"||e[0]==="[")try{return JSON.parse(e)}catch{}return e}function b(e){if(e.length!==1)throw new Error(`Invalid delimiter: must be a single character but is "${e}"`);return e}function Q(e){if(!p(e,0))throw new Error('Invalid EOL character: choose "\\n" or "\\r\\n"');return e}function p(e,n){return x(e,n)||O(e,n)}function x(e,n){return e.charCodeAt(n)===V}function O(e,n){return e.charCodeAt(n)===U&&e.charCodeAt(n+1)===V}const V=10,U=13;function z(e,n){const t=n?.header!==!1,r=b(n?.delimiter||","),i=Q(n?.eol||`\r
`),o=typeof n?.flatten=="function"?n?.flatten:n?.flatten===!1?()=>!1:g,u=n?.fields?Array.isArray(n?.fields)?n?.fields:n?.fields(e):I(e,o),f=n?.formatValue||D(r);let a="";t&&(a+=m()+i);for(let s=0;s<e.length;s++)a+=y(e[s])+i;return a;function m(){return u.map(s=>f(s.name)).join(r)}function y(s){return u.map(w=>f(w.getValue(s))).join(r)}}function B(e,n){const t=n?.header!==!1,r=b(n?.delimiter||",").charCodeAt(0),i=34,o=n?.parseValue||H,u=[];let f=0;const a=y(),m=n?.fields?k(a,Array.isArray(n?.fields)?n?.fields:n?.fields(a)):L(a,n?.nested!==!1);for(;f<e.length;){const l={};s((c,d)=>{m[d]?.setValue(l,c)},o),u.push(l)}return u;function y(){const l=[];return s((c,d)=>{l.push(t?String(c):`Field ${d}`)},c=>c),t||(f=0),l}function s(l,c){let d=0;for(;f<e.length&&!p(e,f);)l(w(c),d),d++,e.charCodeAt(f)===r&&f++;N()}function w(l){const c=f;if(e.charCodeAt(f)===i){do for(f++;e.charCodeAt(f)===i&&e.charCodeAt(f+1)===i;)f+=2;while(f<e.length&&e.charCodeAt(f)!==i);if(e.charCodeAt(f)!==i)throw new Error('Unexpected end: end quote " missing');f++;const d=e.substring(c+1,f-1).replaceAll(G,'"');return l(d,!0)}else{for(;f<e.length&&e.charCodeAt(f)!==r&&!p(e,f);)f++;return l(e.substring(c,f),!1)}}function N(){x(e,f)?f++:O(e,f)&&(f+=2)}}const G=/""/g;export{g as a,B as c,M as i,z as j};
