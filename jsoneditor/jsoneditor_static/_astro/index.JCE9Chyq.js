function Ue(s,i){for(var p=0;p<i.length;p++){const d=i[p];if(typeof d!="string"&&!Array.isArray(d)){for(const h in d)if(h!=="default"&&!(h in s)){const n=Object.getOwnPropertyDescriptor(d,h);n&&Object.defineProperty(s,h,n.get?n:{enumerable:!0,get:()=>d[h]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}var re={},V={},oe={},ye;function ue(){return ye||(ye=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.EolStyle=void 0,function(i){i[i.Crlf=0]="Crlf",i[i.Lf=1]="Lf"}(s.EolStyle||(s.EolStyle={}))}(oe)),oe}var se={},_e;function me(){return _e||(_e=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.CommentPolicy=void 0,function(i){i[i.TreatAsError=0]="TreatAsError",i[i.Remove=1]="Remove",i[i.Preserve=2]="Preserve"}(s.CommentPolicy||(s.CommentPolicy={}))}(se)),se}var ae={},Le;function ce(){return Le||(Le=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.NumberListAlignment=void 0,function(i){i[i.Left=0]="Left",i[i.Right=1]="Right",i[i.Decimal=2]="Decimal",i[i.Normalize=3]="Normalize"}(s.NumberListAlignment||(s.NumberListAlignment={}))}(ae)),ae}var Pe;function fe(){if(Pe)return V;Pe=1,Object.defineProperty(V,"__esModule",{value:!0}),V.FracturedJsonOptions=void 0;const s=ue(),i=me(),p=ce();let d=class{constructor(){this.JsonEolStyle=s.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=p.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=i.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}};return V.FracturedJsonOptions=d,V}var q={},be;function M(){if(be)return q;be=1,Object.defineProperty(q,"__esModule",{value:!0}),q.FracturedJsonError=void 0;let s=class extends Error{constructor(p,d){const h=d?`${p} at idx=${d.Index}, row=${d.Row}, col=${d.Column}`:p;super(h),this.InputPosition=d}};return q.FracturedJsonError=s,q}var W={},z={},Ae;function Ge(){if(Ae)return z;Ae=1,Object.defineProperty(z,"__esModule",{value:!0}),z.StringJoinBuffer=void 0;let s=class{constructor(p){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=p}Add(...p){return this._lineBuff.push(...p),this}EndLine(p){return this.AddLineToWriter(p),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(p){if(this._lineBuff.length===0&&p.length===0)return;let d=this._lineBuff.join("");this._trimTrailingWhitespace&&(d=d.trimEnd()),this._docBuff.push(d+p),this._lineBuff=[]}};return z.StringJoinBuffer=s,z}var U={},le={},Ie;function pe(){return Ie||(Ie=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.BracketPaddingType=void 0,function(i){i[i.Empty=0]="Empty",i[i.Simple=1]="Simple",i[i.Complex=2]="Complex"}(s.BracketPaddingType||(s.BracketPaddingType={}))}(le)),le}var de={},ke;function R(){return ke||(ke=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.JsonItemType=void 0,function(i){i[i.Null=0]="Null",i[i.False=1]="False",i[i.True=2]="True",i[i.String=3]="String",i[i.Number=4]="Number",i[i.Object=5]="Object",i[i.Array=6]="Array",i[i.BlankLine=7]="BlankLine",i[i.LineComment=8]="LineComment",i[i.BlockComment=9]="BlockComment"}(s.JsonItemType||(s.JsonItemType={}))}(de)),de}var Se;function $e(){if(Se)return U;Se=1,Object.defineProperty(U,"__esModule",{value:!0}),U.PaddedFormattingTokens=void 0;const s=pe(),i=ue(),p=R();let d=class{constructor(n,a){this._arrStart=[],this._arrStart[s.BracketPaddingType.Empty]="[",this._arrStart[s.BracketPaddingType.Simple]=n.SimpleBracketPadding?"[ ":"[",this._arrStart[s.BracketPaddingType.Complex]=n.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[s.BracketPaddingType.Empty]="]",this._arrEnd[s.BracketPaddingType.Simple]=n.SimpleBracketPadding?" ]":"]",this._arrEnd[s.BracketPaddingType.Complex]=n.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[s.BracketPaddingType.Empty]="{",this._objStart[s.BracketPaddingType.Simple]=n.SimpleBracketPadding?"{ ":"{",this._objStart[s.BracketPaddingType.Complex]=n.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[s.BracketPaddingType.Empty]="}",this._objEnd[s.BracketPaddingType.Simple]=n.SimpleBracketPadding?" }":"}",this._objEnd[s.BracketPaddingType.Complex]=n.NestedBracketPadding?" }":"}",this._comma=n.CommaPadding?", ":",",this._colon=n.ColonPadding?": ":":",this._comment=n.CommentPadding?" ":"",this._eol=n.JsonEolStyle===i.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(a),this._arrEndLen=this._arrEnd.map(a),this._objStartLen=this._objStart.map(a),this._objEndLen=this._objEnd.map(a),this._indentStrings=["",n.UseTabToIndent?"	":" ".repeat(n.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=a(this._comma),this._colonLen=a(this._colon),this._commentLen=a(this._comment),this._literalNullLen=a("null"),this._literalTrueLen=a("true"),this._literalFalseLen=a("false"),this._prefixStringLen=a(n.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(n){return this._arrStart[n]}ArrEnd(n){return this._arrEnd[n]}ObjStart(n){return this._objStart[n]}ObjEnd(n){return this._objEnd[n]}Start(n,a){return n===p.JsonItemType.Array?this.ArrStart(a):this.ObjStart(a)}End(n,a){return n===p.JsonItemType.Array?this.ArrEnd(a):this.ObjEnd(a)}ArrStartLen(n){return this._arrStartLen[n]}ArrEndLen(n){return this._arrEndLen[n]}ObjStartLen(n){return this._objStartLen[n]}ObjEndLen(n){return this._objEndLen[n]}StartLen(n,a){return n===p.JsonItemType.Array?this.ArrStartLen(a):this.ObjStartLen(a)}EndLen(n,a){return n===p.JsonItemType.Array?this.ArrEndLen(a):this.ObjEndLen(a)}Indent(n){if(n>=this._indentStrings.length)for(let a=this._indentStrings.length;a<=n;++a)this._indentStrings.push(this._indentStrings[a-1]+this._indentStrings[1]);return this._indentStrings[n]}Spaces(n){if(n>=this._spaceStrings.length)for(let a=this._spaceStrings.length;a<=n;++a)this._spaceStrings.push(" ".repeat(a));return this._spaceStrings[n]}};return U.PaddedFormattingTokens=d,U}var G={},Ee;function Ke(){if(Ee)return G;Ee=1,Object.defineProperty(G,"__esModule",{value:!0}),G.TableTemplate=void 0;const s=R(),i=pe(),p=ce();let d=class J{constructor(n,a){this.LocationInParent=void 0,this.Type=s.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=i.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=n,this._numberListAlignment=a,this.AllowNumberNormalization=a===p.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(n){for(const a of n.Children)this.MeasureRowSegment(a);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(n){for(let a=this.GetTemplateComplexity();a>=0;--a){if(this.TotalLength<=n)return!0;this.PruneAndRecompute(a-1)}return!1}FormatNumber(n,a){const L=this._numberListAlignment===p.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?p.NumberListAlignment.Left:this._numberListAlignment;switch(L){case p.NumberListAlignment.Left:n.Add(a.Value,this._pads.Spaces(this.SimpleValueLength-a.ValueLength));return;case p.NumberListAlignment.Right:n.Add(this._pads.Spaces(this.SimpleValueLength-a.ValueLength),a.Value);return}let I,g,f,e;if(L===p.NumberListAlignment.Normalize){if(a.Type===s.JsonItemType.Null){n.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-a.ValueLength),a.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}I=this._maxDigBeforeDecNorm,g=this._maxDigAfterDecNorm,f=Number(a.Value).toFixed(g),e=f.length}else I=this._maxDigBeforeDecRaw,g=this._maxDigAfterDecRaw,f=a.Value,e=a.ValueLength;let t,r;const o=f.search(J._dotOrE);o>0?(t=I-o,r=this.CompositeValueLength-t-e):(t=I-e,r=this.CompositeValueLength-I),n.Add(this._pads.Spaces(t),f,this._pads.Spaces(r))}MeasureRowSegment(n){if(!(n.Type===s.JsonItemType.BlankLine||n.Type===s.JsonItemType.BlockComment||n.Type===s.JsonItemType.LineComment)&&(n.Type===s.JsonItemType.False||n.Type===s.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===s.JsonItemType.True||this.Type===s.JsonItemType.Null),this.Type=s.JsonItemType.True,this.IsNumberList=!1):n.Type===s.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===s.JsonItemType.Number||this.Type===s.JsonItemType.Null),this.Type=s.JsonItemType.Number):n.Type===s.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===n.Type||this.Type===s.JsonItemType.Null),this.Type===s.JsonItemType.Null&&(this.Type=n.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!n.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,n.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,n.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,n.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,n.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,n.PostfixCommentLength),n.Complexity>=2&&(this.PadType=i.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(n.Type===s.JsonItemType.Array)for(let a=0;a<n.Children.length;++a)this.Children.length<=a&&this.Children.push(new J(this._pads,this._numberListAlignment)),this.Children[a].MeasureRowSegment(n.Children[a]);else if(n.Type===s.JsonItemType.Object){if(this.ContainsDuplicateKeys(n.Children)){this.IsRowDataCompatible=!1;return}for(const a of n.Children){let L=this.Children.find(I=>I.LocationInParent===a.Name);L||(L=new J(this._pads,this._numberListAlignment),L.LocationInParent=a.Name,this.Children.push(L)),L.MeasureRowSegment(a)}}else if(n.Type===s.JsonItemType.Number&&this.IsNumberList){const L=Number(n.Value),I=L.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(L)&&L!==1/0&&L!==-1/0&&I.length<=15&&I.indexOf("e")<0&&(L!==0||J._trulyZeroValString.test(n.Value)));const g=I.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,g>=0?g:I.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,g>=0?I.length-g-1:0);const f=n.Value.search(J._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,f>=0?f:n.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,f>=0?n.ValueLength-f-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(n){(n<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const a of this.Children)a.PruneAndRecompute(n-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const a=this.Children.map(L=>L.TotalLength).reduce((L,I)=>L+I);this.CompositeValueLength=a+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const n=this.Children.map(a=>a.GetTemplateComplexity());return 1+Math.max(...n)}ContainsDuplicateKeys(n){const a=n.map(L=>L.Name);return a.some((L,I)=>a.indexOf(L)!==I)}GetNumberFieldWidth(){if(this._numberListAlignment===p.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const n=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+n+this._maxDigAfterDecNorm}else if(this._numberListAlignment===p.NumberListAlignment.Decimal){const n=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+n+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return G.TableTemplate=d,d._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),d._dotOrE=new RegExp("[.eE]"),G}var $={},K={},xe;function Xe(){if(xe)return K;xe=1,Object.defineProperty(K,"__esModule",{value:!0}),K.TokenEnumerator=void 0;const s=M();let i=class{constructor(d){this._generator=d}get Current(){if(!this._current)throw new s.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const d=this._generator.next();return this._current=d.value,!d.done}};return K.TokenEnumerator=i,K}var X={},we;function Me(){if(we)return X;we=1,Object.defineProperty(X,"__esModule",{value:!0}),X.JsonItem=void 0;const s=R();let i=class{constructor(){this.Type=s.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return X.JsonItem=i,X}var he={},Oe;function Re(){return Oe||(Oe=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.TokenType=void 0,function(i){i[i.Invalid=0]="Invalid",i[i.BeginArray=1]="BeginArray",i[i.EndArray=2]="EndArray",i[i.BeginObject=3]="BeginObject",i[i.EndObject=4]="EndObject",i[i.String=5]="String",i[i.Number=6]="Number",i[i.Null=7]="Null",i[i.True=8]="True",i[i.False=9]="False",i[i.BlockComment=10]="BlockComment",i[i.LineComment=11]="LineComment",i[i.BlankLine=12]="BlankLine",i[i.Comma=13]="Comma",i[i.Colon=14]="Colon"}(s.TokenType||(s.TokenType={}))}(he)),he}var Z={},H={},Ne;function Ze(){if(Ne)return H;Ne=1,Object.defineProperty(H,"__esModule",{value:!0}),H.ScannerState=void 0;const s=M();let i=class{constructor(h){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=h}Advance(h){if(this.CurrentPosition.Index>=p)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!h)}NewLine(){if(this.CurrentPosition.Index>=p)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(h,n=!1){const a=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:h,Text:n?a.trimEnd():a,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(h,n){return{Type:h,Text:n,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(h){throw new s.FracturedJsonError(h,this.CurrentPosition)}};H.ScannerState=i;const p=2e9;return H}var Fe;function He(){if(Fe)return Z;Fe=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.TokenGenerator=void 0;const s=Ze(),i=Re();function*p(l){const c=new s.ScannerState(l);for(;;){if(c.AtEnd())return;const _=c.Current();switch(_){case I:case e:case f:c.Advance(!0);break;case g:c.NonWhitespaceSinceLastNewline||(yield c.MakeToken(i.TokenType.BlankLine,`
`)),c.NewLine(),c.SetTokenStart();break;case u:yield d(c,"{",i.TokenType.BeginObject);break;case C:yield d(c,"}",i.TokenType.EndObject);break;case b:yield d(c,"[",i.TokenType.BeginArray);break;case P:yield d(c,"]",i.TokenType.EndArray);break;case y:yield d(c,":",i.TokenType.Colon);break;case E:yield d(c,",",i.TokenType.Comma);break;case Te:yield h(c,"true",i.TokenType.True);break;case v:yield h(c,"false",i.TokenType.False);break;case Ce:yield h(c,"null",i.TokenType.Null);break;case t:yield n(c);break;case m:yield a(c);break;case N:yield L(c);break;default:B(_)||c.Throw("Unexpected character"),yield L(c);break}}}Z.TokenGenerator=p;function d(l,c,_){l.SetTokenStart();const k=l.MakeToken(_,c);return l.Advance(!1),k}function h(l,c,_){l.SetTokenStart();for(let ie=1;ie<c.length;++ie)l.AtEnd()&&l.Throw("Unexpected end of input while processing keyword"),l.Advance(!1),l.Current()!==c.charCodeAt(ie)&&l.Throw("Unexpected keyword");const k=l.MakeToken(_,c);return l.Advance(!1),k}function n(l){l.SetTokenStart(),l.AtEnd()&&l.Throw("Unexpected end of input while processing comment"),l.Advance(!1);let c=!1;l.Current()===r?c=!0:l.Current()!==t&&l.Throw("Bad character for start of comment"),l.Advance(!1);let _=!1;for(;;){if(l.AtEnd())if(c)l.Throw("Unexpected end of input while processing comment");else return l.MakeTokenFromBuffer(i.TokenType.LineComment,!0);const k=l.Current();if(k===g){if(l.NewLine(),!c)return l.MakeTokenFromBuffer(i.TokenType.LineComment,!0);continue}if(l.Advance(!1),k===t&&_)return l.MakeTokenFromBuffer(i.TokenType.BlockComment);_=k===r}}function a(l){l.SetTokenStart(),l.Advance(!1);let c=!1,_=0;for(;;){l.AtEnd()&&l.Throw("Unexpected end of input while processing string");const k=l.Current();if(_>0){qe(k)||l.Throw("Bad unicode escape in string"),_-=1,l.Advance(!1);continue}if(c){We(k)||l.Throw("Bad escaped character in string"),k===ge&&(_=4),c=!1,l.Advance(!1);continue}if(ze(k)&&l.Throw("Control characters are not allowed in strings"),l.Advance(!1),k===m)return l.MakeTokenFromBuffer(i.TokenType.String);k===o&&(c=!0)}}function L(l){l.SetTokenStart();let c=A.Beginning;for(;;){const _=l.Current();let k=O.ValidAndConsumed;switch(c){case A.Beginning:_===N?c=A.PastLeadingSign:_===x?c=A.PastWhole:B(_)?c=A.PastFirstDigitOfWhole:k=O.InvalidatesToken;break;case A.PastLeadingSign:B(_)?_===x?c=A.PastWhole:c=A.PastFirstDigitOfWhole:k=O.InvalidatesToken;break;case A.PastFirstDigitOfWhole:_===F?c=A.PastDecimalPoint:_===j||_===te?c=A.PastE:B(_)||(k=O.StartOfNewToken);break;case A.PastWhole:_===F?c=A.PastDecimalPoint:_===j||_===te?c=A.PastE:k=O.StartOfNewToken;break;case A.PastDecimalPoint:B(_)?c=A.PastFirstDigitOfFractional:k=O.InvalidatesToken;break;case A.PastFirstDigitOfFractional:_===j||_===te?c=A.PastE:B(_)||(k=O.StartOfNewToken);break;case A.PastE:_===T||_===N?c=A.PastExpSign:B(_)?c=A.PastFirstDigitOfExponent:k=O.InvalidatesToken;break;case A.PastExpSign:B(_)?c=A.PastFirstDigitOfExponent:k=O.InvalidatesToken;break;case A.PastFirstDigitOfExponent:B(_)||(k=O.StartOfNewToken);break}if(k===O.InvalidatesToken&&l.Throw("Bad character while processing number"),k===O.StartOfNewToken)return l.MakeTokenFromBuffer(i.TokenType.Number);if(!l.AtEnd()){l.Advance(!1);continue}switch(c){case A.PastFirstDigitOfWhole:case A.PastWhole:case A.PastFirstDigitOfFractional:case A.PastFirstDigitOfExponent:return l.MakeTokenFromBuffer(i.TokenType.Number);default:l.Throw("Unexpected end of input while processing number");break}}}const I=32,g=10,f=13,e=9,t=47,r=42,o=92,m=34,u=123,C=125,b=91,P=93,y=58,E=44,T=43,N=45,F=46,x=48,S=57,Y=97,ne=65,ee=98,j=101,te=69,v=102,je=70,Ce=110,Ve=114,Te=116,ge=117;function B(l){return l>=x&&l<=S}function qe(l){return l>=x&&l<=S||l>=Y&&l<=v||l>=ne&&l<=je}function We(l){switch(l){case m:case o:case t:case ee:case v:case Ce:case Ve:case Te:case ge:return!0;default:return!1}}function ze(l){return l>=0&&l<=31||l===127||l>=128&&l<=159}var A;(function(l){l[l.Beginning=0]="Beginning",l[l.PastLeadingSign=1]="PastLeadingSign",l[l.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",l[l.PastWhole=3]="PastWhole",l[l.PastDecimalPoint=4]="PastDecimalPoint",l[l.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",l[l.PastE=6]="PastE",l[l.PastExpSign=7]="PastExpSign",l[l.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(A||(A={}));var O;return function(l){l[l.InvalidatesToken=0]="InvalidatesToken",l[l.ValidAndConsumed=1]="ValidAndConsumed",l[l.StartOfNewToken=2]="StartOfNewToken"}(O||(O={})),Z}var Be;function Qe(){if(Be)return $;Be=1,Object.defineProperty($,"__esModule",{value:!0}),$.Parser=void 0;const s=fe(),i=Xe(),p=Me(),d=R(),h=Re(),n=M(),a=me(),L=He();let I=class D{constructor(){this.Options=new s.FracturedJsonOptions}ParseTopLevel(t,r){const o=new i.TokenEnumerator((0,L.TokenGenerator)(t));return this.ParseTopLevelFromEnum(o,r)}ParseTopLevelFromEnum(t,r){const o=[];let m=!1;for(;;){if(!t.MoveNext())return o;const u=this.ParseItem(t),C=u.Type===d.JsonItemType.BlockComment||u.Type===d.JsonItemType.LineComment;if(u.Type===d.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&o.push(u);else if(C){if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new n.FracturedJsonError("Comments not allowed with current options",u.InputPosition);this.Options.CommentPolicy===a.CommentPolicy.Preserve&&o.push(u)}else{if(r&&m)throw new n.FracturedJsonError("Unexpected start of second top level element",u.InputPosition);o.push(u),m=!0}}}ParseItem(t){switch(t.Current.Type){case h.TokenType.BeginArray:return this.ParseArray(t);case h.TokenType.BeginObject:return this.ParseObject(t);default:return this.ParseSimple(t.Current)}}ParseSimple(t){const r=new p.JsonItem;return r.Type=D.ItemTypeFromTokenType(t),r.Value=t.Text,r.InputPosition=t.InputPosition,r.Complexity=0,r}ParseArray(t){if(t.Current.Type!==h.TokenType.BeginArray)throw new n.FracturedJsonError("Parser logic error",t.Current.InputPosition);const r=t.Current.InputPosition;let o,m=-1,u;const C=[];let b=g.EmptyCollection,P=!1,y=0;for(;!P;){const T=D.GetNextTokenOrThrow(t,r);switch(u&&(u?.InputPosition.Row!==T.InputPosition.Row||T.Type===h.TokenType.EndArray)&&(o?(o.PostfixComment=u.Value,o.IsPostCommentLineStyle=u.Type===d.JsonItemType.LineComment):C.push(u),u=void 0),o&&m!==T.InputPosition.Row&&(o=void 0),T.Type){case h.TokenType.EndArray:if(b===g.CommaSeen&&!this.Options.AllowTrailingCommas)throw new n.FracturedJsonError("Array may not end with a comma with current options",T.InputPosition);P=!0;break;case h.TokenType.Comma:if(b!==g.ElementSeen)throw new n.FracturedJsonError("Unexpected comma in array",T.InputPosition);b=g.CommaSeen;break;case h.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(T));break;case h.TokenType.BlockComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new n.FracturedJsonError("Comments not allowed with current options",T.InputPosition);u&&(C.push(u),u=void 0);const F=this.ParseSimple(T);if(D.IsMultilineComment(F)){C.push(F);break}if(o&&b===g.ElementSeen){o.PostfixComment=F.Value,o.IsPostCommentLineStyle=!1,o=void 0;break}u=F;break;case h.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new n.FracturedJsonError("Comments not allowed with current options",T.InputPosition);if(u){C.push(u),C.push(this.ParseSimple(T)),u=void 0;break}if(o){o.PostfixComment=T.Text,o.IsPostCommentLineStyle=!0,o=void 0;break}C.push(this.ParseSimple(T));break;case h.TokenType.False:case h.TokenType.True:case h.TokenType.Null:case h.TokenType.String:case h.TokenType.Number:case h.TokenType.BeginArray:case h.TokenType.BeginObject:if(b===g.ElementSeen)throw new n.FracturedJsonError("Comma missing while processing array",T.InputPosition);const x=this.ParseItem(t);b=g.ElementSeen,y=Math.max(y,x.Complexity+1),u&&(x.PrefixComment=u.Value,u=void 0),C.push(x),o=x,m=t.Current.InputPosition.Row;break;default:throw new n.FracturedJsonError("Unexpected token in array",T.InputPosition)}}const E=new p.JsonItem;return E.Type=d.JsonItemType.Array,E.InputPosition=r,E.Complexity=y,E.Children=C,E}ParseObject(t){if(t.Current.Type!==h.TokenType.BeginObject)throw new n.FracturedJsonError("Parser logic error",t.Current.InputPosition);const r=t.Current.InputPosition,o=[];let m,u,C=-1,b=[],P=[],y,E=!1,T=f.BeforePropName,N=0,F=!1;for(;!F;){const S=D.GetNextTokenOrThrow(t,r),Y=C!==S.InputPosition.Row,ne=S.Type===h.TokenType.EndObject,ee=S.Type===h.TokenType.String&&T===f.AfterComma,j=y&&(S.Type===h.TokenType.BlockComment||S.Type===h.TokenType.LineComment);if(m&&u&&(Y||ne||ee||j)){let v;ee&&E&&!Y&&(v=y,y=void 0),D.AttachObjectValuePieces(o,m,u,C,b,P,y),N=Math.max(N,u.Complexity+1),m=void 0,u=void 0,b=[],P=[],y=void 0,v&&b.push(v)}switch(S.Type){case h.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||T===f.AfterPropName||T===f.AfterColon)break;o.push(...b),b=[],o.push(this.ParseSimple(S));break;case h.TokenType.BlockComment:case h.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new n.FracturedJsonError("Comments not allowed with current options",S.InputPosition);T===f.BeforePropName||!m?b.push(this.ParseSimple(S)):T===f.AfterPropName||T===f.AfterColon?P.push(S):(y=this.ParseSimple(S),E=T===f.AfterComma);break;case h.TokenType.EndObject:if(T===f.AfterPropName||T===f.AfterColon)throw new n.FracturedJsonError("Unexpected end of object",S.InputPosition);F=!0;break;case h.TokenType.String:if(T===f.BeforePropName||T===f.AfterComma)m=S,T=f.AfterPropName;else if(T===f.AfterColon)u=this.ParseItem(t),C=t.Current.InputPosition.Row,T=f.AfterPropValue;else throw new n.FracturedJsonError("Unexpected string found while processing object",S.InputPosition);break;case h.TokenType.False:case h.TokenType.True:case h.TokenType.Null:case h.TokenType.Number:case h.TokenType.BeginArray:case h.TokenType.BeginObject:if(T!==f.AfterColon)throw new n.FracturedJsonError("Unexpected element while processing object",S.InputPosition);u=this.ParseItem(t),C=t.Current.InputPosition.Row,T=f.AfterPropValue;break;case h.TokenType.Colon:if(T!==f.AfterPropName)throw new n.FracturedJsonError("Unexpected colon while processing object",S.InputPosition);T=f.AfterColon;break;case h.TokenType.Comma:if(T!==f.AfterPropValue)throw new n.FracturedJsonError("Unexpected comma while processing object",S.InputPosition);T=f.AfterComma;break;default:throw new n.FracturedJsonError("Unexpected token while processing object",S.InputPosition)}}if(!this.Options.AllowTrailingCommas&&T===f.AfterComma)throw new n.FracturedJsonError("Object may not end with comma with current options",t.Current.InputPosition);const x=new p.JsonItem;return x.Type=d.JsonItemType.Object,x.InputPosition=r,x.Complexity=N,x.Children=o,x}static ItemTypeFromTokenType(t){switch(t.Type){case h.TokenType.False:return d.JsonItemType.False;case h.TokenType.True:return d.JsonItemType.True;case h.TokenType.Null:return d.JsonItemType.Null;case h.TokenType.Number:return d.JsonItemType.Number;case h.TokenType.String:return d.JsonItemType.String;case h.TokenType.BlankLine:return d.JsonItemType.BlankLine;case h.TokenType.BlockComment:return d.JsonItemType.BlockComment;case h.TokenType.LineComment:return d.JsonItemType.LineComment;default:throw new n.FracturedJsonError("Unexpected Token",t.InputPosition)}}static GetNextTokenOrThrow(t,r){if(!t.MoveNext())throw new n.FracturedJsonError("Unexpected end of input while processing array or object starting",r);return t.Current}static IsMultilineComment(t){return t.Type===d.JsonItemType.BlockComment&&t.Value.includes(`
`)}static AttachObjectValuePieces(t,r,o,m,u,C,b){if(o.Name=r.Text,C.length>0){let P="";for(let y=0;y<C.length;++y)P+=C[y].Text,(y<C.length-1||C[y].Type===h.TokenType.LineComment)&&(P+=`
`);o.MiddleComment=P}if(u.length>0){const P=u.pop();P.Type===d.JsonItemType.BlockComment&&P.InputPosition.Row===o.InputPosition.Row?(o.PrefixComment=P.Value,t.push(...u)):(t.push(...u),t.push(P))}t.push(o),b&&(!this.IsMultilineComment(b)&&b.InputPosition.Row===m?(o.PostfixComment=b.Value,o.IsPostCommentLineStyle=b.Type===d.JsonItemType.LineComment):t.push(b))}};$.Parser=I;var g;(function(e){e[e.EmptyCollection=0]="EmptyCollection",e[e.ElementSeen=1]="ElementSeen",e[e.CommaSeen=2]="CommaSeen"})(g||(g={}));var f;return function(e){e[e.BeforePropName=0]="BeforePropName",e[e.AfterPropName=1]="AfterPropName",e[e.AfterColon=2]="AfterColon",e[e.AfterPropValue=3]="AfterPropValue",e[e.AfterComma=4]="AfterComma"}(f||(f={})),$}var Q={},ve;function Ye(){if(ve)return Q;ve=1,Object.defineProperty(Q,"__esModule",{value:!0}),Q.ConvertDataToDom=void 0;const s=Me(),i=R(),p=M();function d(h,n,a=100){var L;if(a<=0)throw new p.FracturedJsonError("Depth limit exceeded - possible circular reference");const I=typeof h;switch(I){case"function":case"symbol":case"undefined":return}if(h&&h.toJSON){const f=JSON.parse(JSON.stringify(h));return d(f,n,a-1)}const g=new s.JsonItem;if(g.Name=n?JSON.stringify(n):"",h===null)g.Type=i.JsonItemType.Null,g.Value="null";else if(Array.isArray(h)){g.Type=i.JsonItemType.Array,g.Children=h.map(f=>{var e;return(e=d(f,void 0,a-1))!==null&&e!==void 0?e:d(null,void 0,a-1)}),g.Children=[];for(let f=0;f<h.length;++f)g.Children[f]=(L=d(h[f],void 0,a-1))!==null&&L!==void 0?L:d(null,void 0,a-1)}else if(I==="object"){g.Type=i.JsonItemType.Object;for(const f of Object.entries(h)){const e=d(f[1],f[0],a-1);e&&g.Children.push(e)}}else{switch(I){case"string":g.Type=i.JsonItemType.String;break;case"number":case"bigint":g.Type=i.JsonItemType.Number;break;case"boolean":g.Type=h?i.JsonItemType.True:i.JsonItemType.False;break}g.Value=JSON.stringify(h)}if(g.Children.length>0){const f=g.Children.map(e=>e.Complexity).reduce((e,t)=>Math.max(e,t));g.Complexity=f+1}return g}return Q.ConvertDataToDom=d,Q}var Je;function et(){if(Je)return W;Je=1,Object.defineProperty(W,"__esModule",{value:!0}),W.Formatter=void 0;const s=fe(),i=Ge(),p=$e(),d=R(),h=pe(),n=Ke(),a=M(),L=Qe(),I=Ye();let g=class w{constructor(){this.Options=new s.FracturedJsonOptions,this.StringLengthFunc=w.StringLengthByCharCount,this._buffer=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new p.PaddedFormattingTokens(new s.FracturedJsonOptions,w.StringLengthByCharCount)}static StringLengthByCharCount(e){return e.length}Reformat(e,t=0){const r=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace),o=new L.Parser;o.Options=this.Options;const m=o.ParseTopLevel(e,!0);return this.FormatTopLevel(m,t,r),r.Flush(),r.AsString()}Serialize(e,t=0,r=100){const o=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace),m=(0,I.ConvertDataToDom)(e,void 0,r);if(m)return this.FormatTopLevel([m],t,o),o.Flush(),o.AsString()}Minify(e){const t=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace),r=new L.Parser;r.Options=this.Options;const o=r.ParseTopLevel(e,!0);return this.MinifyTopLevel(o,t),t.Flush(),t.AsString()}FormatTopLevel(e,t,r){this._buffer=r,this._pads=new p.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const o of e)this.ComputeItemLengths(o),this.FormatItem(o,t,!1);this._buffer=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(e,t){this._buffer=t,this._pads=new p.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let r=!0;for(const o of e)r=this.MinifyItem(o,r);this._buffer=new i.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(e){const t=`
`;for(const r of e.Children)this.ComputeItemLengths(r);switch(e.Type){case d.JsonItemType.Null:e.ValueLength=this._pads.LiteralNullLen;break;case d.JsonItemType.True:e.ValueLength=this._pads.LiteralTrueLen;break;case d.JsonItemType.False:e.ValueLength=this._pads.LiteralFalseLen;break;default:e.ValueLength=this.StringLengthFunc(e.Value);break}if(e.NameLength=this.StringLengthFunc(e.Name),e.PrefixCommentLength=this.StringLengthFunc(e.PrefixComment),e.MiddleCommentLength=this.StringLengthFunc(e.MiddleComment),e.PostfixCommentLength=this.StringLengthFunc(e.PostfixComment),e.RequiresMultipleLines=w.IsCommentOrBlankLine(e.Type)||e.Children.some(r=>r.RequiresMultipleLines||r.IsPostCommentLineStyle)||e.PrefixComment.indexOf(t)>=0||e.MiddleComment.indexOf(t)>=0||e.PostfixComment.indexOf(t)>=0||e.Value.indexOf(t)>=0,e.Type===d.JsonItemType.Array||e.Type===d.JsonItemType.Object){const r=w.GetPaddingType(e);e.ValueLength=this._pads.StartLen(e.Type,r)+this._pads.EndLen(e.Type,r)+e.Children.map(o=>o.MinimumTotalLength).reduce((o,m)=>o+m,0)+Math.max(0,this._pads.CommaLen*(e.Children.length-1))}e.MinimumTotalLength=(e.PrefixCommentLength>0?e.PrefixCommentLength+this._pads.CommentLen:0)+(e.NameLength>0?e.NameLength+this._pads.ColonLen:0)+(e.MiddleCommentLength>0?e.MiddleCommentLength+this._pads.CommentLen:0)+e.ValueLength+(e.PostfixCommentLength>0?e.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(e,t,r){switch(e.Type){case d.JsonItemType.Array:case d.JsonItemType.Object:this.FormatContainer(e,t,r);break;case d.JsonItemType.BlankLine:this.FormatBlankLine();break;case d.JsonItemType.BlockComment:case d.JsonItemType.LineComment:this.FormatStandaloneComment(e,t);break;default:e.RequiresMultipleLines?this.FormatSplitKeyValue(e,t,r):this.FormatInlineElement(e,t,r);break}}FormatContainer(e,t,r){t>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(e,t,r)||this.FormatContainerCompactMultiline(e,t,r))||t>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(e,t,r)||this.FormatContainerExpanded(e,t,r)}FormatContainerInline(e,t,r){if(e.RequiresMultipleLines)return!1;const o=e.MinimumTotalLength+(r?this._pads.CommaLen:0);return e.Complexity>this.Options.MaxInlineComplexity||o>this.AvailableLineSpace(t)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t)),this.InlineElement(e,r),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(e,t,r){if(e.Type!==d.JsonItemType.Array||e.Complexity>this.Options.MaxCompactArrayComplexity||e.RequiresMultipleLines)return!1;const o=new n.TableTemplate(this._pads,this.Options.NumberListAlignment);o.MeasureTableRoot(e);const m=this.AvailableLineSpace(t+1);let u=this._pads.CommaLen;if(o.IsRowDataCompatible?u+=o.TotalLength:u+=e.Children.map(y=>y.MinimumTotalLength).reduce((y,E)=>y+E,0)/e.Children.length,u*this.Options.MinCompactArrayRowItems>m)return!1;const C=this.StandardFormatStart(e,t);this._buffer.Add(this._pads.Start(e.Type,h.BracketPaddingType.Empty));const b=this.AvailableLineSpace(C+1);let P=-1;for(let y=0;y<e.Children.length;++y){const E=e.Children[y],T=y<e.Children.length-1,N=(T?this._pads.CommaLen:0)+(o.IsRowDataCompatible?o.TotalLength:E.MinimumTotalLength);P<N&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C+1)),P=b),o.IsRowDataCompatible?this.InlineTableRowSegment(o,E,T,!1):this.InlineElement(E,T),P-=N}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(e.Type,h.BracketPaddingType.Empty)),this.StandardFormatEnd(e,r),!0}FormatContainerTable(e,t,r){if(e.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const o=this.AvailableLineSpace(t+1)-this._pads.CommaLen;if(e.Children.filter(P=>!w.IsCommentOrBlankLine(P.Type)).some(P=>P.MinimumTotalLength>o))return!1;const u=new n.TableTemplate(this._pads,this.Options.NumberListAlignment);if(u.MeasureTableRoot(e),!u.IsRowDataCompatible||!u.TryToFit(o))return!1;const C=this.StandardFormatStart(e,t);this._buffer.Add(this._pads.Start(e.Type,h.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const b=w.IndexOfLastElement(e.Children);for(let P=0;P<e.Children.length;++P){const y=e.Children[P];if(y.Type===d.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(y.Type===d.JsonItemType.LineComment||y.Type===d.JsonItemType.BlockComment){this.FormatStandaloneComment(y,C+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C+1)),this.InlineTableRowSegment(u,y,P<b,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(e.Type,h.BracketPaddingType.Empty)),this.StandardFormatEnd(e,r),!0}FormatContainerExpanded(e,t,r){const o=this.StandardFormatStart(e,t);this._buffer.Add(this._pads.Start(e.Type,h.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const m=w.IndexOfLastElement(e.Children);for(let u=0;u<e.Children.length;++u)this.FormatItem(e.Children[u],o+1,u<m);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(o),this._pads.End(e.Type,h.BracketPaddingType.Empty)),this.StandardFormatEnd(e,r)}FormatStandaloneComment(e,t){const r=w.NormalizeMultilineComment(e.Value,e.InputPosition.Column);for(const o of r)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t),o).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(e,t,r){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t)),this.InlineElement(e,r),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(e,t,r){this.StandardFormatStart(e,t),this._buffer.Add(e.Value),this.StandardFormatEnd(e,r)}StandardFormatStart(e,t){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t)),e.PrefixCommentLength>0&&this._buffer.Add(e.PrefixComment,this._pads.Comment),e.NameLength>0&&this._buffer.Add(e.Name,this._pads.Colon),e.MiddleCommentLength===0)return t;if(e.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(e.MiddleComment,this._pads.Comment),t;const r=w.NormalizeMultilineComment(e.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const o of r)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t+1),o).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(t+1)),t+1}StandardFormatEnd(e,t){t&&e.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),e.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,e.PostfixComment),t&&!e.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(e,t){if(e.RequiresMultipleLines)throw new a.FracturedJsonError("Logic error - trying to inline invalid element");e.PrefixCommentLength>0&&this._buffer.Add(e.PrefixComment,this._pads.Comment),e.NameLength>0&&this._buffer.Add(e.Name,this._pads.Colon),e.MiddleCommentLength>0&&this._buffer.Add(e.MiddleComment,this._pads.Comment),this.InlineElementRaw(e),t&&e.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),e.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,e.PostfixComment),t&&!e.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(e){if(e.Type===d.JsonItemType.Array){const t=w.GetPaddingType(e);this._buffer.Add(this._pads.ArrStart(t));for(let r=0;r<e.Children.length;++r)this.InlineElement(e.Children[r],r<e.Children.length-1);this._buffer.Add(this._pads.ArrEnd(t))}else if(e.Type===d.JsonItemType.Object){const t=w.GetPaddingType(e);this._buffer.Add(this._pads.ObjStart(t));for(let r=0;r<e.Children.length;++r)this.InlineElement(e.Children[r],r<e.Children.length-1);this._buffer.Add(this._pads.ObjEnd(t))}else this._buffer.Add(e.Value)}InlineTableRowSegment(e,t,r,o){e.PrefixCommentLength>0&&this._buffer.Add(t.PrefixComment,this._pads.Spaces(e.PrefixCommentLength-t.PrefixCommentLength),this._pads.Comment),e.NameLength>0&&this._buffer.Add(t.Name,this._pads.Spaces(e.NameLength-t.NameLength),this._pads.Colon),e.MiddleCommentLength>0&&this._buffer.Add(t.MiddleComment,this._pads.Spaces(e.MiddleCommentLength-t.MiddleCommentLength),this._pads.Comment),e.Children.length>0&&t.Type!==d.JsonItemType.Null?e.Type===d.JsonItemType.Array?this.InlineTableRawArray(e,t):this.InlineTableRawObject(e,t):e.IsNumberList?e.FormatNumber(this._buffer,t):(this.InlineElementRaw(t),this._buffer.Add(this._pads.Spaces(e.CompositeValueLength-t.ValueLength)));const m=t.IsPostCommentLineStyle||t.PostfixCommentLength===0;m&&(r?this._buffer.Add(this._pads.Comma):o&&this._buffer.Add(this._pads.DummyComma)),e.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,t.PostfixComment,this._pads.Spaces(e.PostfixCommentLength-t.PostfixCommentLength)),m||(r?this._buffer.Add(this._pads.Comma):o&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(e,t){this._buffer.Add(this._pads.ArrStart(e.PadType));for(let r=0;r<e.Children.length;++r){const o=r===e.Children.length-1,m=r===t.Children.length-1,u=r>=t.Children.length,C=e.Children[r];u?(this._buffer.Add(this._pads.Spaces(C.TotalLength)),o||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(C,t.Children[r],!m,!1),m&&!o&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(e.PadType))}InlineTableRawObject(e,t){function r(u){return t.Children.find(C=>C.Name===u.LocationInParent)}const o=e.Children.map(u=>({tt:u,ji:r(u)}));let m=o.length-1;for(;m>=0&&!o[m].ji;)m-=1;this._buffer.Add(this._pads.ObjStart(e.PadType));for(let u=0;u<o.length;++u){const C=o[u].tt,b=o[u].ji,P=u===m,y=u===o.length-1;b?(this.InlineTableRowSegment(C,b,!P,!1),P&&!y&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(C.TotalLength)),y||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(e.PadType))}AvailableLineSpace(e){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*e)}MinifyItem(e,t){const r=`
`;if(this._buffer.Add(e.PrefixComment),e.Name.length>0&&this._buffer.Add(e.Name,":"),e.MiddleComment.indexOf(r)>=0){const o=w.NormalizeMultilineComment(e.MiddleComment,Number.MAX_VALUE);for(const m of o)this._buffer.Add(m,r)}else this._buffer.Add(e.MiddleComment);if(e.Type===d.JsonItemType.Array||e.Type===d.JsonItemType.Object){let o;e.Type===d.JsonItemType.Array?(this._buffer.Add("["),o="]"):(this._buffer.Add("{"),o="}");let m=!1,u=!1;for(const C of e.Children)w.IsCommentOrBlankLine(C.Type)||(m&&this._buffer.Add(","),m=!0),u=this.MinifyItem(C,u);this._buffer.Add(o)}else{if(e.Type===d.JsonItemType.BlankLine)return t||this._buffer.Add(r),this._buffer.Add(r),!0;if(e.Type===d.JsonItemType.LineComment)return t||this._buffer.Add(r),this._buffer.Add(e.Value,r),!0;if(e.Type===d.JsonItemType.BlockComment){if(t||this._buffer.Add(r),e.Value.indexOf(r)>=0){const o=w.NormalizeMultilineComment(e.Value,e.InputPosition.Column);for(const m of o)this._buffer.Add(m,r);return!0}return this._buffer.Add(e.Value,r),!0}else this._buffer.Add(e.Value)}return this._buffer.Add(e.PostfixComment),e.PostfixComment.length>0&&e.IsPostCommentLineStyle?(this._buffer.Add(r),!0):!1}static GetPaddingType(e){return e.Children.length===0?h.BracketPaddingType.Empty:e.Complexity>=2?h.BracketPaddingType.Complex:h.BracketPaddingType.Simple}static NormalizeMultilineComment(e,t){const o=e.replace(/\r/g,"").split(`
`).filter(m=>m.length>0);for(let m=1;m<o.length;++m){const u=o[m];let C=0;for(;C<u.length&&C<t&&/\s/.test(u[C]);)C+=1;o[m]=u.substring(C)}return o}static IndexOfLastElement(e){for(let t=e.length-1;t>=0;--t)if(!this.IsCommentOrBlankLine(e[t].Type))return t;return-1}static IsCommentOrBlankLine(e){return e===d.JsonItemType.BlankLine||e===d.JsonItemType.BlockComment||e===d.JsonItemType.LineComment}};return W.Formatter=g,W}var De;function tt(){return De||(De=1,function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Formatter=s.FracturedJsonError=s.NumberListAlignment=s.EolStyle=s.CommentPolicy=s.FracturedJsonOptions=void 0;var i=fe();Object.defineProperty(s,"FracturedJsonOptions",{enumerable:!0,get:function(){return i.FracturedJsonOptions}});var p=me();Object.defineProperty(s,"CommentPolicy",{enumerable:!0,get:function(){return p.CommentPolicy}});var d=ue();Object.defineProperty(s,"EolStyle",{enumerable:!0,get:function(){return d.EolStyle}});var h=ce();Object.defineProperty(s,"NumberListAlignment",{enumerable:!0,get:function(){return h.NumberListAlignment}});var n=M();Object.defineProperty(s,"FracturedJsonError",{enumerable:!0,get:function(){return n.FracturedJsonError}});var a=et();Object.defineProperty(s,"Formatter",{enumerable:!0,get:function(){return a.Formatter}})}(re)),re}var nt=tt();const ht=Ue({__proto__:null},[nt]);export{ht as i};
