import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{h as rn,j as sn}from"./floating-ui.dom.BVVWGuUJ.js";import{a8 as Le,a9 as Ee,aa as ke,q as ne,ab as Te,e as an,ac as ue,G as $,ad as gt,ae as vt,af as Fe,ag as Re,g as ye,m as on,D as ln,ah as at,a as Se,j as q,o as cn,n as dn}from"./index.BGd5Ky0j.js";import{r as un,a as g,c as X,f as _,m as jt,n as ot,g as mn,R as pn,o as hn,p as fn,P as le,q as xn,s as Me,F as J,S as gn,t as it,u as vn}from"./debug.DRjTZKen.js";import{r as f,a as jn}from"./index.BqJQxrZM.js";import{c as bn,J as Y,t as yn,a as Sn,u as Nn,o as Ne,W as Cn}from"./JSONEditorComponent.bUYtOSjE.js";import{K as Ue,L as We,J as ce,M as me,N as pe,O as Ve,P as bt,Q as wn,R as On,x as Dn,y as En,u as P,t as kn,z as Tn,h as Fn,D as Z,T as lt,U as Rn,c as Be,S as ee,f as yt,b as An,V as In,B as he,s as _n,W as Ln,C as Mn,q as Un}from"./fontUtils.BV5T5L3M.js";import{G as St,i as Ce,A as Wn,M as re,t as Vn,B as Bn,H as Jn}from"./modal.Bkg2kDE0.js";import{u as Je,m as Kn,M as fe,l as $n,d as zn}from"./App.B6cng7kV.js";import{c as Ae,P as qn,p as we}from"./prompt.lRC3jknX.js";import{a as Ke}from"./useConfig.Dv4xtEmJ.js";import{i as Hn,a as Nt,j as Pn,c as Ct}from"./csv2json.D_hONyjZ.js";import{s as Gn}from"./index.B2YNouON.js";import{c as wt}from"./client.VHhTgbqr.js";import{i as $e}from"./isEmpty.yPRxPQfS.js";import{g as Xn}from"./_commonjsHelpers.CqkleIqs.js";import"./json-schema-draft-06.BUXeb-dj.js";import"./preload-helper.CLcXU_4U.js";import"./index.-DrlcFrU.js";import"./constants.DLPHiTRJ.js";import"./PricingPlansModal.CsfcNgzq.js";import"./PricingTable.C-drzN-W.js";/* empty css                              */function Ie(){return Ie=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},Ie.apply(this,arguments)}var ct=function(t){var n=f.useRef(t);return n.current=t,n},Yn="ðŸ’¡ react-cool-dimensions: the browser doesn't support Resize Observer, please use polyfill: https://github.com/wellyshen/react-cool-dimensions#resizeobserver-polyfill",Qn="ðŸ’¡ react-cool-dimensions: the browser doesn't support border-box size, fallback to content-box size. Please see: https://github.com/wellyshen/react-cool-dimensions#border-box-size-measurement",Zn=function(n,r){var i="",c=-1;return Object.keys(n).forEach(function(a){var s=n[a];r>=s&&s>c&&(i=a,c=s)}),i},dt=function(n){var r={},i=r.useBorderBoxSize,c=r.breakpoints,a=r.updateOnBreakpointChange,s=r.shouldUpdate,u=r.onResize,l=r.polyfill,d=f.useState({currentBreakpoint:"",width:null,height:null}),v=d[0],x=d[1],S=f.useRef({}),O=f.useRef(),N=f.useRef(),E=f.useRef(!1),y=f.useRef(),o=ct(u),F=ct(s),C=f.useCallback(function(){N.current&&N.current.disconnect()},[]),w=f.useCallback(function(p){p&&p!==y.current&&(C(),y.current=p,x({currentBreakpoint:"",width:p.clientWidth,height:p.clientHeight})),N.current&&y.current&&N.current.observe(y.current)},[C]);return f.useEffect(function(){if((!("ResizeObserver"in window)||!("ResizeObserverEntry"in window))&&!l)return console.error(Yn),function(){return null};var p=null;return N.current=new(l||ResizeObserver)(function(D){var j=D[0];p=requestAnimationFrame(function(){var A=j.contentBoxSize,W=j.borderBoxSize,U=j.contentRect,R=A;i&&(W?R=W:E.current||(console.warn(Qn),E.current=!0)),R=Array.isArray(R)?R[0]:R;var h=R?R.inlineSize:U.width,k=R?R.blockSize:U.height;if(!(h===S.current.width&&k===S.current.height)){S.current={width:h,height:k};var T={currentBreakpoint:"",width:h,height:k,entry:j,observe:w,unobserve:C};c?(T.currentBreakpoint=Zn(c,h),T.currentBreakpoint!==O.current&&(o.current&&o.current(T),O.current=T.currentBreakpoint)):o.current&&o.current(T);var L={currentBreakpoint:T.currentBreakpoint,width:h,height:k,entry:j};if(!(F.current&&!F.current(L))){if(!F.current&&c&&a){x(function(V){return V.currentBreakpoint!==L.currentBreakpoint?L:V});return}x(L)}}})}),w(),function(){C(),p&&cancelAnimationFrame(p)}},[JSON.stringify(c),i,w,C,a]),Ie({},v,{observe:w,unobserve:C})},K={},ut;function er(){if(ut)return K;ut=1;var t=K&&K.__extends||function(){var a=function(s,u){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,d){l.__proto__=d}||function(l,d){for(var v in d)d.hasOwnProperty(v)&&(l[v]=d[v])},a(s,u)};return function(s,u){a(s,u);function l(){this.constructor=s}s.prototype=u===null?Object.create(u):(l.prototype=u.prototype,new l)}}(),n=K&&K.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(K,"__esModule",{value:!0});var r=n(un()),i=n(jn()),c=function(a){t(s,a);function s(u){var l=a.call(this,u)||this;return l.resetDragging=function(){l.frameDragCounter=0,l.setState({draggingOverFrame:!1,draggingOverTarget:!1})},l.handleWindowDragOverOrDrop=function(d){d.preventDefault()},l.handleFrameDrag=function(d){if(s.eventHasFiles(d)){if(l.frameDragCounter+=d.type==="dragenter"?1:-1,l.frameDragCounter===1){l.setState({draggingOverFrame:!0}),l.props.onFrameDragEnter&&l.props.onFrameDragEnter(d);return}if(l.frameDragCounter===0){l.setState({draggingOverFrame:!1}),l.props.onFrameDragLeave&&l.props.onFrameDragLeave(d);return}}},l.handleFrameDrop=function(d){l.state.draggingOverTarget||(l.resetDragging(),l.props.onFrameDrop&&l.props.onFrameDrop(d))},l.handleDragOver=function(d){s.eventHasFiles(d)&&(l.setState({draggingOverTarget:!0}),!s.isIE()&&l.props.dropEffect&&(d.dataTransfer.dropEffect=l.props.dropEffect),l.props.onDragOver&&l.props.onDragOver(d))},l.handleDragLeave=function(d){l.setState({draggingOverTarget:!1}),l.props.onDragLeave&&l.props.onDragLeave(d)},l.handleDrop=function(d){if(l.props.onDrop&&s.eventHasFiles(d)){var v=d.dataTransfer?d.dataTransfer.files:null;l.props.onDrop(v,d)}l.resetDragging()},l.handleTargetClick=function(d){l.props.onTargetClick&&l.props.onTargetClick(d),l.resetDragging()},l.stopFrameListeners=function(d){d&&(d.removeEventListener("dragenter",l.handleFrameDrag),d.removeEventListener("dragleave",l.handleFrameDrag),d.removeEventListener("drop",l.handleFrameDrop))},l.startFrameListeners=function(d){d&&(d.addEventListener("dragenter",l.handleFrameDrag),d.addEventListener("dragleave",l.handleFrameDrag),d.addEventListener("drop",l.handleFrameDrop))},l.frameDragCounter=0,l.state={draggingOverFrame:!1,draggingOverTarget:!1},l}return s.prototype.componentDidMount=function(){this.startFrameListeners(this.props.frame),this.resetDragging(),window.addEventListener("dragover",this.handleWindowDragOverOrDrop),window.addEventListener("drop",this.handleWindowDragOverOrDrop)},s.prototype.componentDidUpdate=function(u){u.frame!==this.props.frame&&(this.resetDragging(),this.stopFrameListeners(u.frame),this.startFrameListeners(this.props.frame))},s.prototype.componentWillUnmount=function(){this.stopFrameListeners(this.props.frame),window.removeEventListener("dragover",this.handleWindowDragOverOrDrop),window.removeEventListener("drop",this.handleWindowDragOverOrDrop)},s.prototype.render=function(){var u=this.props,l=u.children,d=u.className,v=u.targetClassName,x=u.draggingOverFrameClassName,S=u.draggingOverTargetClassName,O=this.state,N=O.draggingOverTarget,E=O.draggingOverFrame,y=v;return E&&(y+=" "+x),N&&(y+=" "+S),i.default.createElement("div",{className:d,onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},i.default.createElement("div",{className:y,onClick:this.handleTargetClick},l))},s.isIE=function(){return typeof window<"u"&&(window.navigator.userAgent.indexOf("MSIE")!==-1||window.navigator.appVersion.indexOf("Trident/")>0)},s.eventHasFiles=function(u){var l=!1;if(u.dataTransfer){var d=u.dataTransfer.types;for(var v in d)if(d[v]==="Files"){l=!0;break}}return l},s.propTypes={className:r.default.string,targetClassName:r.default.string,draggingOverFrameClassName:r.default.string,draggingOverTargetClassName:r.default.string,onDragOver:r.default.func,onDragLeave:r.default.func,onDrop:r.default.func,onTargetClick:r.default.func,dropEffect:r.default.oneOf(["copy","move","link","none"]),frame:function(u,l,d){var v=u[l];if(v==null)return new Error("Warning: Required prop `"+l+"` was not specified in `"+d+"`");if(v!==document&&!(v instanceof HTMLElement))return new Error("Warning: Prop `"+l+"` must be one of the following: document, HTMLElement!")},onFrameDragEnter:r.default.func,onFrameDragLeave:r.default.func,onFrameDrop:r.default.func},s.defaultProps={dropEffect:"copy",frame:typeof window>"u"?void 0:window.document,className:"file-drop",targetClassName:"file-drop-target",draggingOverFrameClassName:"file-drop-dragging-over-frame",draggingOverTargetClassName:"file-drop-dragging-over-target"},s}(i.default.PureComponent);return K.FileDrop=c,K}var tr=er();function nr({backgroundColor:t}){const n={color:t||"white",position:"absolute",bottom:4,left:4,fontSize:"60%"};return e.jsxs("div",{className:"private-cloud-icon",children:[e.jsx(g,{icon:Le,fixedWidth:!0}),e.jsx(g,{style:n,icon:Ee,fixedWidth:!0})]})}function rr(){return e.jsx("div",{className:"public-cloud-icon",children:e.jsx(g,{icon:ke,fixedWidth:!0})})}function ze({documentSource:t,access:n,backgroundColor:r}){return t==="cloud"?n&&!n.some(Ue)?e.jsx(nr,{backgroundColor:r}):e.jsx(rr,{}):null}function te(){return te=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},te.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var sr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?f.useLayoutEffect:f.useEffect,ar=function(n){var r=f.useRef(n);return sr(function(){r.current=n}),f.useCallback(function(){return r.current},[r])},or={status:"not-requested",loading:!1,result:void 0,error:void 0},Ot={status:"loading",loading:!0,result:void 0,error:void 0},ir=function(n){return Ot},lr=function(n,r){return{status:"success",loading:!1,result:n,error:void 0}},cr=function(n,r){return{status:"error",loading:!1,result:void 0,error:n}},mt=function(){},dr={initialState:function(n){return n&&n.executeOnMount?Ot:or},executeOnMount:!0,executeOnUpdate:!0,setLoading:ir,setResult:lr,setError:cr,onSuccess:mt,onError:mt},ur=function(n){return te({},dr,{},n)},mr=function(n){var r=f.useState(function(){return n.initialState(n)}),i=r[0],c=r[1],a=f.useCallback(function(){return c(n.initialState(n))},[c,n]),s=f.useCallback(function(){return c(n.setLoading(i))},[i,c]),u=f.useCallback(function(v){return c(n.setResult(v,i))},[i,c]),l=f.useCallback(function(v){return c(n.setError(v,i))},[i,c]),d=f.useCallback(function(v){return c(te({},i,{},v))},[i,c]);return{value:i,set:c,merge:d,reset:a,setLoading:s,setResult:u,setError:l}},pr=function(){var n=f.useRef(!1);return f.useEffect(function(){return n.current=!0,function(){n.current=!1}},[]),function(){return n.current}},hr=function(){var n=f.useRef(null);return{set:function(i){return n.current=i},get:function(){return n.current},is:function(i){return n.current===i}}},fr=function(n,r,i){!r&&(r=[]);var c=ur(i),a=f.useState(null),s=a[0],u=a[1],l=mr(c),d=pr(),v=hr(),x=function(o){return d()&&v.is(o)},S=function(){for(var o=arguments.length,F=new Array(o),C=0;C<o;C++)F[C]=arguments[C];var w=function(){try{return Promise.resolve(n.apply(void 0,F))}catch(p){return Promise.reject(p)}}();return u(F),v.set(w),l.setLoading(),w.then(function(p){x(w)&&l.setResult(p),c.onSuccess(p,{isCurrent:function(){return v.is(w)}})},function(p){x(w)&&l.setError(p),c.onError(p,{isCurrent:function(){return v.is(w)}})}),w},O=ar(S),N=f.useCallback(function(){return O().apply(void 0,arguments)},[O]),E=!d();return f.useEffect(function(){var y=function(){return O().apply(void 0,r)};E&&c.executeOnMount&&y(),!E&&c.executeOnUpdate&&y()},r),te({},l.value,{set:l.set,merge:l.merge,reset:l.reset,execute:N,currentPromise:v.get(),currentParams:s})};function G(t,n,r){return fr(t,n,r)}const xr=X("jsoneditoronline:useSchema"),gr={type:"none"};function vr(t,n,r,i){t||(t=gr);const c=G(s=>me(s)?bt(s.compoundKey):Promise.resolve(null),[t]),a=G(s=>pe(s)?St(s.url):Promise.resolve(void 0),[t]);if(f.useEffect(()=>{xr("schema config changed",{schemaConfig:t})},[t]),t)try{if(We(t))return{loading:!1,error:null,content:oe(ce(t.content,i),i),name:null};if(me(t))return{loading:c.status==="loading",error:c.error?String(c.error):null,content:c.result&&c.status!=="loading"?oe(ce(c.result.content,i),i):null,name:c.result?.document?.name||null};if(pe(t))return{loading:a.status==="loading",error:a.error?String(a.error):null,content:a.status!=="loading"&&a.result!==void 0?oe(a.result,i):null,name:null};if(Ve(t)){const s=t.panelId;if(s===n)return{loading:!1,error:"Error: Cannot select panel itself as JSON schema.",content:null,name:null};const u=r.find(l=>l.panelId===s);return u?{loading:!1,error:null,content:oe(ce(u.content,i),i),name:null}:{loading:!1,error:`Error: Panel with id "${t.panelId}" not found.`,content:null,name:null}}}catch(s){return{loading:!1,error:String(s),content:null,name:null}}return{loading:!1,error:null,content:null,name:null}}function oe(t,n){return t&&bn({schema:t,parser:n}),t}function jr({error:t,onNew:n,onSignIn:r}){const[i,c]=f.useState(!1),a=Ce(t)&&t.status===401;function s(){c(!0)}return e.jsxs("div",{className:"loading-error",children:[e.jsxs("div",{className:"message",children:[e.jsx(g,{icon:ne})," ",t.toString()]}),Ce(t)&&i&&e.jsxs("div",{className:"reasons",children:[e.jsx("br",{}),"Possible reasons:",e.jsx("ul",{children:t.reasons.map((u,l)=>e.jsx("li",{children:u},l))})]}),e.jsxs("div",{className:"suggestion",children:[a&&e.jsxs("button",{className:"action primary",onClick:()=>r(),children:[e.jsx(g,{icon:Te})," Sign in"]}),e.jsxs("button",{className:_("action",{primary:!a}),onClick:()=>n(),children:[e.jsx(g,{icon:Te})," Open a new document"]}),Ce(t)&&!i&&e.jsxs("button",{className:"action",onClick:s,children:[e.jsx(g,{icon:an})," Read more"]})]})]})}const br=X("jsoneditoronline:CopyToClipboardButton"),yr=1e3;function Dt({clipboardText:t,text:n,copyingText:r,copiedText:i,title:c,disabled:a}){const[s,u]=f.useState(!1),[l,d]=f.useState(!1),[v]=Je();async function x(){br("copy to clipboard button"),navigator.clipboard?(u(!0),await navigator.clipboard.writeText(await Sr(t)),u(!1),d(!0),v(()=>d(!1),yr)):console.error("Error: failed to copy text to clipboard")}return e.jsxs("button",{type:"button",onClick:x,className:"modal-button copy-clipboard",title:c,disabled:a,children:[e.jsx(g,{icon:rn}),s&&r?` ${r}`:l&&i?` ${i}`:n?` ${n}`:void 0]})}function Sr(t){return typeof t=="function"?t():t}const _e={header:!0,delimiter:",",flattenObject:!0,flattenArray:!1},Et=[{value:",",label:"comma"},{value:";",label:"semicolon"},{value:"	",label:"tab"},{value:" ",label:"space"}],Nr=[{value:"auto",label:"auto"},...Et],Cr={header:!0,delimiter:"auto",nested:!0};function wr(t,n,r){const i=Array.isArray(t)?t:[t],c=n?.header??_e.header,a=n?.delimiter??_e.delimiter,s=n.flattenObject?n.flattenArray?Hn:Nt:()=>!1,u=Er(a,r);return Pn(i,{header:c,delimiter:a,flatten:s,formatValue:u})}function Or(t,n,r){const i=n.delimiter==="auto"?Dr(t,Et.map(c=>c.value))||",":n.delimiter;return Ct(t,{...n,delimiter:i,parseValue:kr(r)})}function Dr(t,n){const r=t.indexOf(`
`),i=r!==-1?t.substring(0,r):t,c=n.map(s=>{try{const u=Ct(i,{delimiter:s,nested:!1,header:!1});return{delimiter:s,count:Nt(u[0])?Object.keys(u[0]).length:1}}catch{return{delimiter:s,count:1}}}).filter(s=>s.count>1),a=Gn(c,s=>-s.count);if(a.length===1||a.length>1&&a[0].count>a[1].count)return a[0].delimiter}function Er(t,n){const r=new RegExp("["+t+`"\r
]`),i=/"/g;function c(a){return r.test(a)||a.length===0?`"${a.replaceAll(i,'""')}"`:a}return function a(s){return typeof s=="string"?c(s):typeof s=="number"||typeof s=="boolean"?s+"":On(s)?s.toString():s==null?"":a(n.stringify(s))}}function kr(t){const n=Wn(t,JSON)?a=>{const s=Number(a);return isNaN(s)?a:s}:a=>{try{return wn(a)}catch{return a}},r=/""/g;return function(s){return s.length===0?null:c(i(s))};function i(a){return a[0]==='"'?a.substring(1,a.length-1).replaceAll(r,'"'):a}function c(a){if(a[0]>="-"&&a[0]<="9")return n(a);if(a==="true")return!0;if(a==="false")return!1;if(a==="null")return null;if(a[0]==="{"||a[0]==="[")try{return t.parse(a)}catch{}return a}}const kt=X("jsoneditoronline:CSVExportModal");function Tr({parser:t,name:n,content:r,onClose:i}){const c=Rr(r,t),a=c?.json?.length>jt,[s,u]=Ke("csvExportOptions",_e),[l,d]=f.useState(n||"document"),[v,x]=f.useState(!0),[S,O]=f.useState(!1),[N,E]=f.useState(!1),[y,o]=f.useState({csv:void 0,error:void 0}),[F]=Je();f.useEffect(()=>{F(()=>{o(ie(c,s,a,t)),x(!1)},0)},[]);function C(p){kt("applyOptions",p);const D={...s,...p};u(D),o(ie(c,D,a,t))}function w(){try{E(!0),setTimeout(()=>{const D=ie(c,s,!1,t).csv,j=Dn(l,".csv");En(j,D||""),E(!1),i()},0)}catch(p){E(!1),console.error(p),P(p)}}return e.jsx(re,{onRequestClose:i,className:"csv-export",children:e.jsxs("div",{className:"modal modal-csv-export",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h1",{children:[e.jsx(g,{icon:ue})," CSV Export"]})}),e.jsxs("div",{className:"modal-contents",children:[e.jsx("div",{className:"modal-text",children:"Enter a name for the CSV file:"}),e.jsx("input",{type:"text",className:"regular",value:l,onChange:p=>d(p.target.value)}),e.jsxs("div",{className:"modal-text",children:["Options:",e.jsxs("label",{title:"Select a delimiter to separate values",children:["Delimiter"," ",e.jsxs("select",{value:s.delimiter||",",onChange:p=>{C({delimiter:p.target.value})},disabled:N||S,children:[e.jsx("option",{value:",",children:"comma"}),e.jsx("option",{value:";",children:"semicolon"}),e.jsx("option",{value:"	",children:"tab"}),e.jsx("option",{value:" ",children:"space"})]})]}),e.jsxs("label",{title:"When selected, the first line of the CSV will be a header with the column names",children:[e.jsx("input",{type:"checkbox",checked:s.header===!0,onChange:p=>{C({header:p.target.checked})},disabled:N||S})," ","Header"]}),e.jsxs("label",{title:"When selected nested objects will be flattened into separate CSV columns",children:[e.jsx("input",{type:"checkbox",checked:s.flattenObject||!1,onChange:p=>{C({flattenObject:p.target.checked})},disabled:N||S})," ","Flatten nested objects"]}),e.jsxs("label",{className:_({disabled:!s.flattenObject}),title:"When selected nested arrays will be flattened into separate CSV columns. Only applicable when flatten nested objects is selected",children:[e.jsx("input",{type:"checkbox",disabled:N||S||!s.flattenObject||!1,checked:s.flattenArray,onChange:p=>{C({flattenArray:p.target.checked})}})," ","Flatten nested arrays"]})]}),e.jsxs("div",{className:_("preview-area",{loading:v}),children:[e.jsx("textarea",{readOnly:!0,wrap:y.error?"":"off",className:_("regular","csv-preview",{error:!!y.error}),value:v?"":y.error?"Error: could not parse JSON. Please close the CSV Export modal, fix your JSON document, then export to CSV again.":y.csv||""}),v&&e.jsx("div",{className:"overlay",children:e.jsxs("div",{className:"loading",children:[e.jsx(g,{icon:$,spin:!0})," loading..."]})}),a&&e.jsx("div",{className:"truncated-overlay",children:e.jsxs("div",{className:"truncated",children:[e.jsx(g,{icon:ne})," Preview is truncated"]})})]})]}),e.jsxs("div",{className:"modal-action-menu",children:[e.jsx(Dt,{clipboardText:async()=>new Promise(p=>{a&&O(!0),setTimeout(()=>{const j=ie(c,s,!1,t).csv||"";O(!1),p(j)})}),text:"Copy to clipboard",copyingText:"Copying to clipboard...",copiedText:"Copied to clipboard!",title:"Copy CSV data to clipboard",disabled:N||S}),e.jsx("button",{className:"modal-button primary",onClick:w,disabled:N||S,children:N?e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:$,spin:!0})," Saving to disk"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:gt})," Save to disk"]})}),e.jsx("button",{className:"modal-button",onClick:()=>i(),children:"Close"})]})]})})}function Fr(t,n){try{return{json:ce(t,n),error:void 0}}catch(r){return{json:void 0,error:String(r)}}}const Rr=Kn(Fr);function ie(t,n,r,i){try{if(kt("createPreview",{parsedJson:t}),t.error||t.json===void 0)return{csv:void 0,error:t.error};console.time("to csv");const c=r&&Array.isArray(t.json)?t.json.slice(0,jt):t.json,a=wr(c,n,i);return console.timeEnd("to csv"),{csv:r?a+"...":a,error:void 0}}catch(c){return console.error(c),{csv:void 0,error:String(c)}}}const de=X("jsoneditoronline:CSVImportModal");function Ar({parserId:t,file:n,indentation:r,maxLineLength:i,onApply:c,onClose:a}){const[s,u]=Ke("csvImportOptions",Cr),[l,d]=f.useState(fe.table),[v,x]=f.useState(!0),[S,O]=f.useState(!1),[N,E]=f.useState(""),[y,o]=f.useState({parser:JSON,csvTruncated:void 0,json:void 0,error:void 0}),[F]=Je(),C=kn(n.name,".csv");f.useEffect(()=>{w().catch(j=>console.error(j))},[n]);async function w(){de("Loading CSV file from disk...",{file:n}),x(!0);try{const{name:j,data:A}=await Tn(n);de("Loaded CSV file from disk",{data:A,name:j}),E(A),o(Oe(A,s,t,ot)),x(!1)}catch(j){console.log(j),P(j)}finally{x(!1)}}function p(j){de("applyOptions",j);const A={...s,...j};u(A),o(Oe(N,A,t,ot))}function D(){try{O(!0),F(()=>{const j=Oe(N,s,t,1/0),A=j.json!==void 0?{json:j.json}:{text:""};O(!1),c(A,C),a()},0)}catch(j){O(!1),console.error(j),P(j)}}return e.jsx(re,{onRequestClose:a,className:"csv-import",children:e.jsxs("div",{className:"modal modal-csv-import",children:[e.jsx("div",{className:"modal-header",children:e.jsxs("h1",{children:[e.jsx(g,{icon:ue})," CSV Import"]})}),e.jsxs("div",{className:"modal-contents",children:[e.jsx("div",{className:"modal-text",children:"File:"}),e.jsx("input",{type:"text",readOnly:!0,disabled:!0,className:"regular",value:C}),e.jsxs("div",{className:"modal-text",children:["Options:",e.jsxs("label",{title:"Select a delimiter to separate values",children:["Delimiter"," ",e.jsx("select",{value:s.delimiter||",",onChange:j=>{p({delimiter:j.target.value})},disabled:v||S,children:Nr.map(j=>e.jsx("option",{value:j.value,children:j.label},j.value))})]}),e.jsxs("label",{title:"When selected, the first line of the CSV will be interpreted as a header with the column names",children:[e.jsx("input",{type:"checkbox",checked:s.header===!0,onChange:j=>{p({header:j.target.checked})},disabled:v||S})," ","Header"]}),e.jsxs("label",{title:"When selected, field names containing a dot will be parsed into nested JSON objects",children:[e.jsx("input",{type:"checkbox",checked:s.nested||!1,onChange:j=>{p({nested:j.target.checked})},disabled:v||S})," ","Nested objects"]})]}),y.error&&e.jsx("div",{className:"error",children:y.error}),e.jsxs("div",{className:_("preview-area csv-import",{loading:v}),children:[y.json!==void 0&&!y.error&&e.jsx(Y,{mode:l,onChangeMode:d,parser:y.parser,readOnly:!0,indentation:r,maxLineLength:i,mainMenuBar:!0,navigationBar:!0,content:{json:y.json}},JSON.stringify(s)),!v&&y.error&&e.jsx("textarea",{readOnly:!0,className:_("regular","csv-preview"),value:y.csvTruncated||""}),v&&e.jsx("div",{className:_("overlay",{visible:v}),children:e.jsxs("div",{className:"loading",children:[e.jsx(g,{icon:$,spin:!0})," loading..."]})}),y.json!==void 0&&y.csvTruncated!==N&&e.jsx("div",{className:"truncated-overlay",children:e.jsxs("div",{className:"truncated",children:[e.jsx(g,{icon:ne})," Preview is truncated"]})})]})]}),e.jsxs("div",{className:"modal-action-menu",children:[e.jsx("button",{className:"modal-button primary",disabled:!!y.error||v||S,onClick:D,children:S?e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:$,spin:!0})," Importing"]}):e.jsx(e.Fragment,{children:"Import"})}),e.jsx("button",{className:"modal-button",onClick:()=>a(),disabled:v||S,children:"Close"})]})]})})}function Oe(t,n,r,i){const c=Fn(r,t.length),a=yn(t,{length:i,separator:`
`,omission:`
...`});try{de("createPreview",{options:n,parser:c}),console.time("convert csv");const s=Or(a,n,c);return console.timeEnd("convert csv"),{parser:c,csvTruncated:a,json:s,error:void 0}}catch(s){return console.error(s),{parser:c,csvTruncated:a,json:void 0,error:String(s)}}}function qe(t){const n=new Date(t),r=n.toLocaleDateString().split("/").toReversed().join("-"),i=n.toLocaleTimeString().substring(0,5);return r+" "+i}function Ir(t,n){switch(t?.type){case"none":return{description:"None",title:"No JSON Schema selected"};case"url":return{description:`Url "${t.url}"`,title:`External url selected as JSON Schema: ${t.url}`};case"document":return{description:n?`Document "${n}"`:"External document",title:"External document selected as JSON Schema"};case"content":return{description:"Embedded schema",title:"Embedded JSON Schema"};case"panel":{const r=t.panelId===mn?"Left panel":t.panelId===pn?"Right panel":"Panel";return{description:r,title:`${r} selected as JSON Schema`}}default:return{description:"None",title:"No JSON Schema selected"}}}function _r({auth:t,documentSource:n,document:r,schema:i,content:c,parser:a,indentation:s,onSignIn:u,onRename:l,onSchema:d,onAccess:v,onSubscribe:x,onForget:S,onDelete:O,onClose:N}){const E=Z(),y=Z(),o=Z(),F=Z(),C=f.useRef(null),[w,p]=f.useState(r.name),[D,j]=f.useState(!1),A=n?hn[n]:"",W=n==="cloud"?Le:n==="local"?Fe:n==="url"?Re:null,U=lt(r),R=Ir(r.schema||null,i.name),h=Rn(Be(n,r._id));f.useEffect(()=>{C.current?.select()},[C]);async function k(){r.name!==w&&(await l(w),N())}async function T(I){if(I===U)return;if(!t.user||!Bn(t.user)){j(!0);return}const xe=I?[{public:!0}]:[{id:t.user.id,role:"owner"}];await v(xe)}function L(I){I.preventDefault(),u()}function V(I){I.preventDefault(),x()}return e.jsx(re,{onRequestClose:N,className:"modal-document-properties-foreground",children:e.jsxs("div",{className:"modal modal-document-properties",children:[e.jsx("h1",{children:"Document properties"}),e.jsx("table",{className:"properties",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("td",{children:e.jsxs("form",{className:"document-name",onSubmit:async I=>{I.preventDefault(),await k()},children:[e.jsx("input",{ref:I=>{C.current=I||null},type:"text",className:"regular",value:w,onChange:I=>p(I.target.value)}),e.jsx("button",{type:"submit",className:"modal-button primary rename",disabled:r.name===w,children:"Rename"})]})})]}),e.jsx("tr",{children:e.jsx("td",{className:"space",colSpan:2,children:e.jsx("div",{className:"line"})})}),e.jsxs("tr",{children:[e.jsx("th",{title:"JSON Schema",children:"Schema"}),e.jsx("td",{children:e.jsxs("div",{className:"schema-container",children:[e.jsx("div",{className:"schema-description",title:R.title,children:i.loading?e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:$,spin:!0,fixedWidth:!0})," Loading..."]}):i.error?e.jsxs("div",{className:"error",children:[e.jsxs("div",{className:"explanation","data-tooltip-id":E,children:[e.jsx(g,{icon:ne,fixedWidth:!0})," Error"]}),e.jsx(ee,{id:E,children:`Failed to load JSON Schema: ${i.error}`})]}):e.jsxs(e.Fragment,{children:[r.schema.type!=="none"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:vt,fixedWidth:!0})," "]}),R.description]})}),e.jsx("button",{type:"button",className:"modal-button json-schema",onClick:d,title:"Configure JSON Schema",children:"Configure"})]})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Updated"}),e.jsx("td",{children:qe(r.updated)})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Size"}),e.jsx("td",{children:yt(Vn(c,s,a).text.length)})]}),e.jsx("tr",{children:e.jsx("td",{className:"space",colSpan:2,children:e.jsx("div",{className:"line"})})}),e.jsxs("tr",{children:[e.jsx("th",{children:"Storage"}),e.jsxs("td",{children:[W?e.jsx(g,{icon:W,fixedWidth:!0},n):null," ",Sn(n)," ",A&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"explanation","data-tooltip-id":y,children:e.jsx(g,{icon:ye,fixedWidth:!0})}),e.jsx(ee,{id:y,children:A})]})]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Access"}),e.jsx("td",{children:n==="cloud"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"access-options",children:[e.jsxs("label",{title:"Privately saved in the cloud",children:[e.jsx("input",{type:"radio",id:"private",value:"private",name:"access",checked:!U,onChange:()=>T(!1)}),e.jsx(g,{icon:Ee,fixedWidth:!0})," Private"]}),e.jsxs("label",{title:"Publicly saved in the cloud, can be edited by anyone with the link",children:[e.jsx("input",{type:"radio",id:"public",value:"public",name:"access",checked:U,onChange:()=>T(!0)}),e.jsx(g,{icon:ke,fixedWidth:!0})," Public"]})]}),D&&e.jsxs("div",{className:"no-subscription-warning",children:['Storing private documents is only available when you are signed in and have a "Developer" subscription.'," ",t.user?e.jsx(e.Fragment,{children:e.jsx("a",{href:"#",onClick:V,children:"Click here to subscribe"})}):e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"#",onClick:L,children:"Sign in"})," ","or"," ",e.jsx("a",{href:"#",onClick:V,children:"Subscribe"}),"."]})]})]}):n==="url"?e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:ke,fixedWidth:!0})," Public"]}):n==="local"?e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:Ee,fixedWidth:!0})," Private"]}):e.jsx(e.Fragment,{children:"-"})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Share"}),e.jsx("td",{children:n==="local"?e.jsxs("div",{className:"share-contents",children:["Unavailable",e.jsx("div",{"data-tooltip-id":o,children:e.jsx(g,{icon:ye,fixedWidth:!0})}),e.jsx(ee,{id:o,children:'Local documents cannot be shared. To share this document, save it in the cloud first via menu "Save", "Save to cloud".'})]},"not-in-cloud"):n==="cloud"&&h?lt(r)?e.jsxs("div",{className:"share-contents",children:[e.jsx("div",{className:"url-contents",children:e.jsx("a",{href:h,title:h,children:h})}),e.jsx(Dt,{clipboardText:h,title:"Copy url to clipboard",text:"Copy",copiedText:"Copied!"})]}):e.jsxs("div",{className:"share-contents",children:["Unavailable",e.jsx("div",{className:"explanation","data-tooltip-id":F,children:e.jsx(g,{icon:ye,fixedWidth:!0})}),e.jsx(ee,{id:F,children:'Private documents cannot be shared. To share this document, change "Access" to "Public".'})]},"not-public"):e.jsx("div",{className:"share-contents",children:"-"})})]})]})}),e.jsxs("div",{className:"modal-action-menu",children:[e.jsx("button",{className:"modal-button danger",onClick:()=>O(),children:"Delete document"}),n==="cloud"&&e.jsx("button",{className:"modal-button danger",title:"Remove this public document from your files list but do not delete it from the cloud",onClick:()=>S(),disabled:n!=="cloud"||!U,children:"Forget document"}),e.jsx("div",{className:"modal-action-space"}),e.jsx("button",{className:"modal-button",onClick:()=>N(),children:"Close"})]})]})})}const He=X("jsoneditoronline:useListFiles");function Tt({user:t,searchText:n,sortBy:r}){const i=G(Lr,[]),c=G(Mr,[t]),[a]=f.useState($n().filter(An)),s=Nn([...c.result||[],...i.result||[],...a],x=>x.compoundKey),u=!$e(n.trim()),l=u?s.filter(x=>x.document.name.toLowerCase().includes(n.toLowerCase())||x.document._id===n.trim()):s,d=r==="size"?Ne(l,[x=>x.document.size],["desc"]):r==="name"?Ne(l,[x=>x.document.name.toLowerCase()],["asc"]):Ne(l,[x=>x.document.viewed||x.document.updated||x.document.created],["desc"]),v=u?`Showing ${d.length} out of ${s.length} documents`:`Showing ${s.length} documents`;return f.useEffect(()=>{He("sortedFiles",{sortedFiles:d,sortBy:r,searchText:n})},[d,r,n]),{loading:i.loading||c.loading,error:i.error||c.error,recentFiles:d,description:v}}async function Lr(){const t=(await In()).map(n=>({compoundKey:Be("local",n._id),documentSource:"local",document:n}));return He("fetched local documents",t),t}async function Mr(t){if(!t)return[];const r=(await Jn()).map(i=>({compoundKey:Be("cloud",i._id),documentSource:"cloud",document:i}));return He("fetched cloud documents",r),r}const Ur="recentFilesSortedBy";function Wr({user:t,onOpen:n,onClose:r,onDelete:i}){const c=f.useRef(null),a=f.useRef(null),s=f.useRef(null),[u,l]=f.useState(""),[d,v]=Ke(Ur,"date"),{loading:x,error:S,recentFiles:O,description:N}=Tt({user:t,searchText:u,sortBy:d}),[E,y]=f.useState({}),[o,F]=f.useState({});f.useEffect(()=>{s.current&&s.current.focus()},[s]);function C(){c.current&&c.current.close(),r()}async function w(h){C(),await n(h)}function p(h,k,T){if(!a.current)return null;const L=Array.from(a.current.querySelectorAll(k)),V=L.indexOf(h);return V===-1?null:L[V+T]||null}function D(h,k,T){const L=p(h,k,T);return L?.focus(),L?.scrollIntoView({block:"nearest"}),!!L}function j(h){h.key==="ArrowDown"&&(h.preventDefault(),a.current?.querySelector("button.open")?.focus())}function A(h){h.key==="ArrowUp"&&(h.preventDefault(),D(h.currentTarget,"button.open",-1)||s.current?.focus()),h.key==="ArrowDown"&&(h.preventDefault(),D(h.currentTarget,"button.open",1)),h.key==="ArrowRight"&&h.currentTarget.nextElementSibling?.focus()}function W(h){h.key==="ArrowUp"&&(h.preventDefault(),D(h.currentTarget,"button.remove",-1)),h.key==="ArrowDown"&&(h.preventDefault(),D(h.currentTarget,"button.remove",1)),h.key==="ArrowLeft"&&h.currentTarget.previousElementSibling?.focus()}async function U(h,k=_n(h).documentId){Ae({title:"Delete document",text:`Are you sure you want to delete document "${k}"?`,textOk:"Delete",classOk:"danger",onOk:async()=>{y({...E,[h]:!0});try{await i(h),F({...o,[h]:!0})}catch(T){console.error(T),P(T)}y({...E,[h]:!1})}})}function R(){C()}return e.jsx(re,{ref:c,onRequestClose:R,children:e.jsxs("div",{ref:a,className:"modal modal-open",children:[e.jsx("h1",{children:"Open a file"}),e.jsxs("div",{className:"search-box",children:[e.jsxs("span",{className:"search-entry flex",children:["Search:"," ",e.jsx("input",{ref:s,className:"search-text",placeholder:"Enter a document name or id...",value:u,onChange:h=>l(h.target.value),onKeyDown:j})]}),e.jsxs("span",{className:"search-entry",children:["Sort by:"," ",e.jsx("select",{value:d,onChange:h=>v(h.target.value),children:fn.map(({value:h,text:k})=>e.jsx("option",{value:h,children:k},h))})]})]}),e.jsx("div",{className:"info",children:N}),e.jsx("div",{className:"recent-files",children:x?e.jsx("div",{className:"loading",children:e.jsxs("span",{children:[e.jsx(g,{icon:$,spin:!0,fixedWidth:!0})," loading..."]})}):$e(O)?e.jsx("div",{className:"no-files",children:"(no files)"}):O.filter(h=>!o[h.compoundKey]).map(h=>{const k=E[h.compoundKey]||!1,T=_({"recent-file":!0,deleting:k});return e.jsxs("div",{className:T,children:[e.jsxs("button",{className:"modal-button open",title:"Click to open this document",disabled:k,onClick:()=>w(h.compoundKey),onKeyDown:A,children:[e.jsx("div",{className:"file-icon",children:he(h.compoundKey)&&e.jsx("span",{title:!h.document.access||h.document.access.some(Ue)?"This file is stored publicly in the cloud":"This file is stored privately in the cloud",children:e.jsx(ze,{documentSource:h.documentSource,access:h.document.access,backgroundColor:"var(--jeo-background)"})})}),e.jsxs("div",{className:"file-details",children:[e.jsxs("div",{className:"file-name",children:[h.document.name,k?" (deleting...)":null]}),e.jsxs("div",{className:"file-info",children:["Size: ",yt(h.document.size),", last opened:"," ",qe(h.document.viewed)]})]})]}),e.jsx("button",{className:"modal-button remove",disabled:k,title:"Click to delete this document",onClick:()=>U(h.compoundKey,h.document.name),onKeyDown:W,children:e.jsx(g,{icon:on})})]},h.compoundKey)})}),S&&e.jsx("div",{className:"error",children:S.toString()}),e.jsx("div",{className:"modal-action-menu",children:e.jsx("button",{className:"modal-button",onClick:R,children:"Cancel"})})]})})}function Vr(t){const n=document.createElement("div");document.body.appendChild(n);function r(){document.body.removeChild(n)}wt.createRoot(n).render(e.jsx(Wr,{user:t.user,onOpen:t.onOpen,onDelete:t.onDelete,onClose:r}))}var De,pt;function Br(){if(pt)return De;pt=1,De=i;var t=/^(?:\w+:)?\/\/(\S+)$/,n=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,r=/^[^\s\.]+\.\S{2,}$/;function i(c){if(typeof c!="string")return!1;var a=c.match(t);if(!a)return!1;var s=a[1];return s?!!(n.test(s)||r.test(s)):!1}return De}var Jr=Br();const Kr=Xn(Jr);function $r({options:t,value:n,onChange:r,className:i}){return e.jsx("div",{className:_("toggle",i),children:t.map(c=>{const a=_({className:c.className,selected:c.value===n});return e.jsx("button",{className:a,onClick:s=>{s.preventDefault(),r(c.value)},children:c.text},String(c.value))})})}function zr({compoundKey:t,indentation:n,maxLineLength:r,queryLanguageId:i,onChangeQueryLanguage:c}){return e.jsxs("div",{className:"cloud-document-schema-preview",children:["Preview:",e.jsx("div",{className:"preview",children:t?e.jsx(qr,{compoundKey:t,indentation:n,maxLineLength:r,queryLanguageId:i,onChangeQueryLanguage:c}):e.jsx("div",{className:"info",children:"(Select a document)"})})]})}function qr({compoundKey:t,indentation:n,maxLineLength:r,queryLanguageId:i,onChangeQueryLanguage:c}){const{loading:a,result:s,error:u}=G(bt,[t]);if(u)return e.jsx("div",{className:"error",children:u.toString()});if(a)return e.jsx("div",{className:"loading",children:"Loading..."});if(!s)return e.jsx("div",{className:"error",children:"Error: failed to load document..."});try{return e.jsx(Y,{mode:fe.tree,parser:JSON,readOnly:!0,indentation:n,maxLineLength:r,mainMenuBar:!1,navigationBar:!1,queryLanguageId:i,onChangeQueryLanguage:c,content:s.content})}catch(l){return console.error(l),e.jsx("div",{className:"error",children:"Error: Cannot show preview. The selected document contains a JSON parse error."})}}function Hr({panelId:t,allPanels:n,indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a}){const s=n.find(u=>u.panelId===t);try{return s?e.jsx(Y,{mode:fe.tree,parser:JSON,readOnly:!0,indentation:r,maxLineLength:i,mainMenuBar:!1,navigationBar:!1,queryLanguageId:c,onChangeQueryLanguage:a,content:s.content}):e.jsxs("div",{className:"error",children:["Error: Cannot show preview. Panel with id ",t," not found."]})}catch{return e.jsxs("div",{className:"error",children:["Error: Cannot show preview. The ",le[t]," panel contains a JSON parse error."]})}}function Pr({url:t,indentation:n,maxLineLength:r,queryLanguageId:i,onChangeQueryLanguage:c}){const{loading:a,result:s,error:u}=G(St,[t]);return u?e.jsx("div",{className:"error",children:u.toString()}):a?e.jsx("div",{className:"loading",children:"Loading..."}):e.jsx(Y,{mode:fe.tree,readOnly:!0,indentation:n,maxLineLength:r,mainMenuBar:!1,navigationBar:!1,queryLanguageId:i,onChangeQueryLanguage:c,content:{json:s},parser:JSON})}function Gr({user:t,initialSchema:n,indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a,panelId:s,allPanels:u,onOk:l,onClose:d}){const v=f.useRef(null),[x,S]=f.useState(n||{type:"none"}),{recentFiles:O}=Tt({user:t,searchText:"",sortBy:"date"}),N=[{value:"none",text:"None"},{value:"panel",text:"Panel"},{value:"document",text:"Document"},{value:"content",text:"Text"},{value:"url",text:"Url"}];function E(){v.current?.close(),d()}function y(){E()}function o(){l(Yr(x)),E()}function F(p){const D=u.find(j=>j.panelId!==s);S({...x,type:p,panelId:x.panelId===void 0&&D?D.panelId:x.panelId})}function C(p){S({...x,panelId:p})}const w=u.find(p=>p.panelId!==s);return e.jsx(re,{ref:v,onRequestClose:y,className:"schema",children:e.jsxs("div",{className:"modal modal-schema",children:[e.jsx("h1",{children:"JSON schema"}),e.jsxs("p",{children:["Configure a JSON schema for the ",le[s]," panel:"]}),e.jsxs("div",{className:"contents",children:[e.jsx($r,{options:N,value:x.type,onChange:F}),x.type==="none"&&e.jsx("div",{className:"config",children:"No JSON Schema."}),x.type==="panel"&&e.jsx("div",{className:"config",children:Ve(x)?x.panelId!==s?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[xn[x.panelId]," panel contents will be used as JSON Schema."]}),e.jsx("p",{children:"Preview:"}),e.jsx("div",{className:"schema-panel-preview",children:e.jsx(Hr,{panelId:x.panelId,allPanels:u,indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a})})]}):e.jsxs("div",{className:"error",children:[e.jsxs("p",{children:["Error: Currently the ",le[s]," panel itself is selected as JSON Schema. This is not possible."]}),e.jsx("p",{children:e.jsxs("button",{className:"fix-panel",onClick:()=>C(w.panelId),children:["Select ",le[w.panelId]," panel"]})})]}):null}),me(x)&&e.jsxs("div",{className:"config cloud-document",children:[e.jsxs("div",{className:"list-column",children:["Select a document as JSON Schema:",e.jsx("div",{className:"recent-files",children:$e(O)?e.jsx("div",{className:"no-files",children:"(no recent files)"}):O.map(p=>{const D=_("modal-button","recent-file",{selected:p.compoundKey===x.compoundKey});return e.jsxs("button",{className:D,title:"Select this file as JSON Schema",onClick:()=>S({...x,compoundKey:p.compoundKey}),children:[he(p.compoundKey)&&e.jsx("span",{title:!p.document.access||p.document.access.some(Ue)?"This file is stored publicly in the cloud":"This file is stored privately in the cloud",children:e.jsx(ze,{documentSource:p.documentSource,access:p.document.access,backgroundColor:"var(--jeo-background)"})}),e.jsx("div",{className:"name",children:p.document.name}),e.jsxs("div",{className:"updated",children:["Last modified:"," ",p.document.updated?qe(p.document.updated):"(unknown)"]})]},p.compoundKey)})})]}),e.jsx("div",{className:"preview-column",children:e.jsx(zr,{compoundKey:x.compoundKey,indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a})})]}),We(x)&&e.jsxs("div",{className:"config config-jsoneditor",children:[e.jsx("p",{children:"Enter the contents of the JSON Schema:"}),e.jsx(Y,{className:"text-schema",indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a,content:x.content?x.content:{json:{}},parser:JSON,onChange:p=>{S({...x,content:p})}})]}),pe(x)&&e.jsxs("div",{className:"config",children:[e.jsx("p",{children:"Specify the url of the JSON Schema."}),e.jsx("p",{children:"The url must be public: it must not require authentication and needs to have CORS enabled."}),e.jsx("input",{className:"regular schema-url",type:"text",value:x.url||"",onChange:p=>S({...x,url:p.target.value})}),e.jsxs("div",{children:[e.jsx("p",{children:"Preview:"}),e.jsx("div",{className:"schema-url-preview",children:x.url&&Kr(x.url)?e.jsx(Pr,{url:x.url,indentation:r,maxLineLength:i,queryLanguageId:c,onChangeQueryLanguage:a}):e.jsx("div",{className:"info",children:"(enter a valid url)"})})]})]})]}),e.jsxs("div",{className:"modal-action-menu",children:[e.jsx("button",{className:"modal-button",onClick:y,children:"Cancel"}),e.jsx("button",{className:"modal-button primary",onClick:o,children:"Ok"})]})]})})}function Xr(t){const n=document.createElement("div");document.body.appendChild(n);function r(){document.body.removeChild(n)}wt.createRoot(n).render(e.jsx(Gr,{user:t.user,panelId:t.panelId,allPanels:t.allPanels,initialSchema:t.initialSchema,indentation:t.indentation,maxLineLength:t.maxLineLength,queryLanguageId:t.queryLanguageId,onChangeQueryLanguage:t.onChangeQueryLanguage,onOk:t.onOk,onClose:r}))}function Yr(t){return Ln(t)?{type:t.type}:pe(t)?{type:t.type,url:t.url}:me(t)?{type:t.type,compoundKey:t.compoundKey}:We(t)?{type:t.type,content:t.content}:Ve(t)?{type:t.type,panelId:t.panelId}:(console.error("Unknown type of schemaConfig",t),t)}function Qr(t){return Me+encodeURIComponent(t)}function Ft(t){return typeof t=="string"&&t.startsWith(Me)}function Zr(t){return Ft(t)?decodeURIComponent(t.substring(Me.length)):t}function es(t,n){const r="...",i=n-r.length;return t.length>n?t.substring(0,i)+r:t}const H=X("jsoneditoronline:JSONEditorPanel"),ht=455,ft=220,ts=150,xt=40,ns=40;function Os({panelId:t,auth:n,jsonEditorRef:r,setJsonEditorRef:i,mode:c,setMode:a,focus:s,setFocus:u,diff:l,indentation:d,tabSize:v,maxLineLength:x,formattingOnSave:S,setFormattingOnSave:O,escapeControlCharacters:N,escapeUnicodeCharacters:E,flattenColumns:y,documentProvider:o,closeAndForgetDocument:F,closeAndDeleteDocument:C,queryLanguageId:w,onChangeQueryLanguage:p,allPanels:D,onSignIn:j,onSubscribe:A}){const W=Z(),[U,R]=f.useState(!1),[h,k]=f.useState(!1),[T,L]=f.useState(null),[V,I]=f.useState(!1),[xe,Pe]=f.useState(!1),[Ge,Xe]=f.useState(!1),[Rt,At]=f.useState(null),Ye=f.useRef(null),Qe=f.useRef(null),It=f.useRef(null),B=vr(o.document?.schema,t,D,o.parser),{observe:_t,width:Lt}=dt(),{observe:Mt,width:Ut}=dt(),ge=Lt-Ut,z=ge-xt>ht,Wt=ge-(z?ht:ft)>ts,Vt=ge-xt-ft<0,Ze=o.saving&&!o.localStorageError,et=async()=>{await o.newDocument()},Bt=()=>{I(!0)},ve=async()=>{Vr({user:n.user,onOpen:async m=>{H("onOpen",{compoundKey:m}),await o.load(m)},onDelete:C})},se=async()=>{await o.save({force:!0,silent:!1})},Jt=async()=>{o.compoundKey&&he(o.compoundKey)?await o.saveToCloud():we({title:"Save to cloud",text:"Enter a name for the document:",value:o.document?.name??o.loadedName??"New document",textOk:"Save",onOk:async function(m){await o.saveToCloud({updatedName:m}),ae()}})},Kt=async()=>{we({title:"Save to disk",text:"Enter a name for the document:",value:o.document?.name??o.loadedName??"New document",optionText:"Indentation",optionTitle:"Select whether to format or compact the data before saving",optionValue:S,optionOptions:it,optionChange:O,textOk:"Save",onOk:async(m,b)=>{r&&(r.acceptAutoRepair(),setTimeout(async()=>{await o.saveToDisk(m,b),ae()}))}})};function $t(){Pe(!0)}const zt=async()=>{we({className:"save-url-prompt",title:"Save to url",text:e.jsxs("div",{children:[e.jsx("p",{children:"Enter a public url of a server."}),e.jsx("p",{children:"When clicking Save, an HTTP POST request will be send to the selected url with the JSON document as body. The url must be secure (https), must not require authentication, and must have CORS enabled."})]}),value:Rt??o.loadedUrl??"",optionText:"Indentation",optionTitle:"Select whether to format or compact the data before saving",optionValue:S,optionOptions:it,optionChange:O,textOk:"Save",onOk:async(m,b)=>{r&&(r.acceptAutoRepair(),setTimeout(async()=>{At(m),await o.saveToUrl(m,b),ae()}))}})},qt=()=>{R(!0)};function tt(m){L(m),k(!0)}async function nt(m){m.name.toLowerCase().endsWith(".csv")?tt(m):await o.loadFromDisk(m)}async function Q(m){try{if(!r)return;const b=r.acceptAutoRepair(),M=await Mn(b,{parser:o.parser,formatting:m,indentation:d,maxLineLength:x});await navigator.clipboard.writeText(M),ae(),Un("Document copied to clipboard")}catch(b){if(m===J.FORMAT||m===J.SMART&&b.message!==vn||m===J.COMPACT){const M=`Failed to ${m} the document. Fix the document and click copy again, or use "Copy as-is". `+String(b);console.error(M),P(M)}else console.error(b),P(b)}}const Ht=()=>{const{document:m,compoundKey:b}=o;!m||!b||Ae({title:"Forget document",text:`Are you sure you want to forget document "${m.name}"? It will be removed from your files list but will not be deleted from the cloud.`,textOk:"Forget",classOk:"danger",onOk:async()=>{await F(b)}})},Pt=()=>{const{document:m,compoundKey:b}=o;!m||!b||Ae({title:"Delete document",text:`Are you sure you want to delete document "${m.name}"?`,textOk:"Delete",classOk:"danger",onOk:async()=>{await C(b)}})},Gt=async m=>{await o.updateContent(m)};function Xt(m){const b=m.length>0?"/"+m.join("/"):"",M=l?.[b];if(M)return`diff-${M}`}function rt(){Xr({user:n.user,indentation:d,maxLineLength:x,queryLanguageId:w,onChangeQueryLanguage:p,initialSchema:o.document?.schema,panelId:t,allPanels:D,onOk:async m=>{H("Selected JSON Schema",m),await o.updateSchema(m)}})}async function Yt(m){await o.updateAccess(m)}const Qt=o.compoundKey&&he(o.compoundKey)?"Configure document. Document is stored in the cloud":"Configure document. Document is stored locally in your browser";f.useEffect(()=>{async function m(b){const M=b.key.toUpperCase();(b.ctrlKey||b.metaKey)&&!b.shiftKey&&M==="S"&&(b.preventDefault(),b.stopPropagation(),await se()),(b.ctrlKey||b.metaKey)&&!b.shiftKey&&M==="O"&&(b.preventDefault(),b.stopPropagation(),await ve()),(b.ctrlKey||b.metaKey)&&b.altKey&&!b.shiftKey&&M==="I"&&(b.preventDefault(),b.stopPropagation(),I(!0))}if(s)return window.document.body.addEventListener("keydown",m),()=>{window.document.body.removeEventListener("keydown",m)}},[s,t,ve,se,I]);function ae(){r&&r.focus()}function Zt(m,{modal:b}){if(Ge&&!b)return m.concat({type:"button",icon:dn,title:"Exit full screen (ESC)",onClick:st})}function en(){H("openFullScreen"),H("disabling page scroll"),zn(),Xe(!0)}function st(){H("closeFullScreen"),Xe(!1)}function je(m){m.key==="Escape"&&(m.preventDefault(),m.target.blur())}function be(m){m.target.blur()}function tn(m){m.key==="Escape"&&st()}return e.jsxs("div",{className:"panel",ref:_t,onKeyDown:tn,children:[V&&o.documentSource&&o.document&&e.jsx(_r,{auth:n,documentSource:o.documentSource,document:o.document,content:o.content,schema:B,parser:o.parser,indentation:d,onSignIn:j,onRename:m=>o.updateName(m),onSchema:rt,onAccess:Yt,onSubscribe:A,onForget:Ht,onDelete:Pt,onClose:()=>I(!1)}),e.jsxs(tr.FileDrop,{onDrop:async m=>{m&&await nt(m[0])},children:[e.jsx("div",{className:"drag-space-before"}),e.jsx("div",{className:"drag-info",children:"Drag 'n drop your JSON or CSV document here..."}),e.jsx("div",{className:"drag-space-after"})]}),e.jsxs("div",{className:_("panel-menu",{wrap:Vt}),children:[e.jsxs("div",{className:"document-details",ref:Mt,children:[e.jsx("div",{className:"local-storage-error-icon","data-tooltip-id":W,style:{display:o.localStorageError?"":"none"},children:e.jsx(g,{icon:ne})}),e.jsx(ee,{id:W,children:String(o.localStorageError)}),o.document&&o.document.schema.type!=="none"&&e.jsxs("button",{className:_("menu-button schema",{error:B.error}),disabled:o.loading||!!o.error,onClick:rt,title:B.error?`Failed to load JSON Schema: ${B.error}`:B.loading?"Loading JSON schema...":"This document is validated against a JSON schema. Click to view or change the schema.",children:[B.loading?e.jsx(g,{icon:$,spin:!0,fixedWidth:!0}):e.jsx(g,{icon:vt,fixedWidth:!0}),B.error&&e.jsx("span",{className:"error",children:"Error"})]}),!o.loading&&o.document&&o.documentSource&&e.jsxs("button",{disabled:o.loading||!!o.error,className:_("menu-button name",{unnamed:!o.document.name}),title:Qt,onClick:Bt,children:[e.jsx(ze,{documentSource:o.documentSource,access:o.document.access,backgroundColor:"var(--jeo-theme-color)"}),es(o.document.name,ns),e.jsx(g,{icon:ln,fixedWidth:!0})]})]}),Wt?e.jsxs("div",{className:_("unsaved-changes",{visible:Ze}),children:[e.jsx("span",{children:"changed ("}),e.jsx("button",{className:"save-now",onClick:se,children:"save now"}),e.jsx("span",{children:")"})]}):e.jsx("button",{className:_("menu-button unsaved-changes",{visible:Ze}),onClick:se,title:"There are unsaved changes. Click to save now.",children:e.jsx(g,{icon:sn})}),e.jsx("div",{className:"space"}),e.jsxs("div",{className:"buttons",children:[e.jsxs("button",{className:"menu-button",disabled:o.loading,onClick:et,title:"Open a new, empty document",children:[e.jsx(g,{icon:Te}),z&&" New"]}),e.jsxs("div",{tabIndex:-1,className:"dropdown-button",onKeyDown:je,children:[e.jsxs("button",{className:"menu-button",children:[e.jsx(g,{icon:at}),z&&" Open"," ",e.jsx(g,{icon:Se})]}),e.jsxs("div",{className:"dropdown-menu right",onClick:be,children:[e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:ve,title:"Open a document stored in the cloud or local storage",children:[e.jsx(g,{icon:at,fixedWidth:!0})," Open file"]}),e.jsx("input",{type:"file",ref:Ye,onChange:m=>{m.target.files&&nt(m.target.files[0])},style:{display:"none"}}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Ye.current?.click(),title:"Open a JSON or CSV document from disk",children:[e.jsx(g,{icon:Fe,fixedWidth:!0})," Open from disk"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:$t,title:"Open a document from url",children:[e.jsx(g,{icon:Re,fixedWidth:!0})," Open from url"]}),e.jsx("div",{className:"dropdown-menu-separator"}),e.jsx("input",{type:"file",accept:"text/csv",ref:Qe,onChange:m=>{m.target.files&&tt(m.target.files[0])},style:{display:"none"}}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Qe.current?.click(),title:"Import a CSV document and convert it to JSON (comma separated values)",children:[e.jsx(g,{icon:ue,fixedWidth:!0})," Import CSV"]})]})]}),e.jsxs("div",{tabIndex:-1,className:"dropdown-button",onKeyDown:je,children:[e.jsxs("button",{className:"menu-button",children:[e.jsx(g,{icon:gt}),z&&" Save"," ",e.jsx(g,{icon:Se})]}),e.jsxs("div",{className:"dropdown-menu",onClick:be,children:[e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading||!!o.error,onClick:Jt,title:"Save this document in the cloud",children:[e.jsx(g,{icon:Le,fixedWidth:!0})," Save to cloud"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading||!!o.error,onClick:Kt,title:"Save this document to disk",children:[e.jsx(g,{icon:Fe,fixedWidth:!0})," Save to disk"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading||!!o.error,onClick:zt,title:"Save this document to a public url",children:[e.jsx(g,{icon:Re,fixedWidth:!0})," Send to url"]}),e.jsx("div",{className:"dropdown-menu-separator"}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading||!!o.error,onClick:qt,title:"Export the JSON document to CSV (comma separated values)",children:[e.jsx(g,{icon:ue,fixedWidth:!0})," Export to CSV"]})]})]}),e.jsxs("div",{tabIndex:-1,className:"dropdown-button",onKeyDown:je,children:[e.jsxs("button",{className:"menu-button",children:[e.jsx(g,{icon:q}),z&&" Copy"," ",e.jsx(g,{icon:Se})]}),e.jsxs("div",{className:"dropdown-menu",onClick:be,children:[e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Q(J.FORMAT),title:"Copy this document to the system clipboard in formatted form",children:[e.jsx(g,{icon:q})," Copy formatted"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Q(J.SMART),title:`Copy this document to the system clipboard, ${gn}`,children:[e.jsx(g,{icon:q})," Copy smart formatted"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Q(J.COMPACT),title:"Copy this document to the system clipboard in compacted form",children:[e.jsx(g,{icon:q})," Copy compacted"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Q(J.ESCAPED),title:"Copy this document to the system clipboard with escaped quotes, so it can be pasted directly inside a string",children:[e.jsx(g,{icon:q})," Copy escaped"]}),e.jsxs("button",{className:"dropdown-menu-button",disabled:o.loading,onClick:()=>Q(J.KEEP),title:"Copy this document to the system clipboard without changing indentation",children:[e.jsx(g,{icon:q})," Copy as-is"]})]})]}),e.jsxs("button",{className:"menu-button",disabled:o.loading||!!o.error,onClick:en,title:"Show the editor full screen (ESC to exit)",children:[e.jsx(g,{icon:cn}),z&&" Full screen"]})]})]}),e.jsxs("div",{className:_("panel-contents",{error:!!o.error,"full-screen":Ge}),children:[e.jsx(Y,{id:t,onJsonEditorRef:m=>{i(m),It.current=m},mode:c,parser:o.parser,indentation:d,tabSize:v,maxLineLength:x,escapeControlCharacters:N,escapeUnicodeCharacters:E,flattenColumns:y,content:o.content,queryLanguageId:w,onChangeQueryLanguage:p,onChange:Gt,onChangeMode:a,onClassName:l?Xt:void 0,onRenderMenu:Zt,onFocus:()=>u(!0),onBlur:()=>u(!1),schema:B.content}),o.loading?e.jsx("div",{className:"overlay",children:e.jsxs("div",{className:"loading",children:[e.jsx(g,{icon:$,spin:!0,fixedWidth:!0})," loading..."]})}):null,o.error?e.jsx("div",{className:"overlay error",children:e.jsx(jr,{error:o.error,onNew:et,onSignIn:j})}):null]}),U&&e.jsx(Tr,{parser:o.parser,name:o.document?.name??o.loadedName??null,content:o.content,onClose:()=>R(!1)}),h&&T&&e.jsx(Ar,{parserId:o.parserId,file:T,indentation:d,maxLineLength:x,onApply:async(m,b)=>{a(Cn.table),await o.newDocumentWithContent({name:b,content:m})},onClose:()=>k(!1)}),xe&&e.jsx(qn,{className:"open-url-prompt",title:"Open url",text:e.jsxs("div",{children:[e.jsx("p",{children:"Enter a public url."}),e.jsx("p",{children:"Urls which are unsecure (http) or do not have CORS enabled can be loaded via the proxy when they have a public url. Urls which need authentication cannot be loaded."})]}),value:o.loadedUrl?Zr(o.loadedUrl):"",checkboxText:"Use proxy",checkboxTitle:"The request will be routed via the backend of jsoneditoronline.org to work around unsecure urls (http) and CORS limitations",checkboxValue:Ft(o.loadedUrl),textOk:"Open",onOk:async(m,b,M)=>{H("Open from url",{url:m,optionValue:b,checkboxValue:M});const nn=M?Qr(m):m;await o.loadFromUrl(nn)},onClose:()=>Pe(!1)})]})}export{Os as default};
